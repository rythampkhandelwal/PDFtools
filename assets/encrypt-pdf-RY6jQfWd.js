import{n as f,m as v,r as F,d as I,f as L,c as x,i as B}from"./main-Dzxg2eZZ.js";import"./mobileMenu-CQFcDk7p.js";import"./full-width-CrKHpSp0.js";import"./simple-mode-footer-rW7ABm1-.js";const l={file:null};function w(){l.file=null;const t=document.getElementById("file-display-area");t&&(t.innerHTML="");const e=document.getElementById("tool-options");e&&e.classList.add("hidden");const s=document.getElementById("file-input");s&&(s.value="");const i=document.getElementById("user-password-input");i&&(i.value="");const n=document.getElementById("owner-password-input");n&&(n.value="")}async function b(){const t=document.getElementById("file-display-area"),e=document.getElementById("tool-options");if(t)if(t.innerHTML="",l.file){const s=document.createElement("div");s.className="flex items-center justify-between bg-gray-700 p-3 rounded-lg text-sm";const i=document.createElement("div");i.className="flex flex-col overflow-hidden";const n=document.createElement("div");n.className="truncate font-medium text-gray-200 text-sm mb-1",n.textContent=l.file.name;const r=document.createElement("div");r.className="text-xs text-gray-400",r.textContent=L(l.file.size),i.append(n,r);const o=document.createElement("button");o.className="ml-4 text-red-400 hover:text-red-300 flex-shrink-0",o.innerHTML='<i data-lucide="trash-2" class="w-4 h-4"></i>',o.onclick=function(){w()},s.append(i,o),t.appendChild(s),x({icons:B}),e&&e.classList.remove("hidden")}else e&&e.classList.add("hidden")}function g(t){if(t&&t.length>0){const e=t[0];(e.type==="application/pdf"||e.name.toLowerCase().endsWith(".pdf"))&&(l.file=e,b())}}async function P(){if(!l.file){f("No File","Please upload a PDF file first.");return}const t=document.getElementById("user-password-input")?.value||"",e=document.getElementById("owner-password-input")?.value||"";if(!t){f("Input Required","Please enter a user password.");return}const s=e||t,i=e!=="",n="/input.pdf",r="/output.pdf";let o;const a=document.getElementById("loader-modal"),c=document.getElementById("loader-text");try{a&&a.classList.remove("hidden"),c&&(c.textContent="Initializing encryption..."),o=await v(),c&&(c.textContent="Reading PDF...");const d=await F(l.file),h=new Uint8Array(d);o.FS.writeFile(n,h),c&&(c.textContent="Encrypting PDF with 256-bit AES...");const u=[n,"--encrypt",t,s,"256"];i&&u.push("--modify=none","--extract=n","--print=none","--accessibility=n","--annotate=n","--assemble=n","--form=n","--modify-other=n"),u.push("--",r);try{o.callMain(u)}catch(y){throw console.error("qpdf execution error:",y),new Error("Encryption failed: "+(y.message||"Unknown error"))}c&&(c.textContent="Preparing download...");const p=o.FS.readFile(r,{encoding:"binary"});if(!p||p.length===0)throw new Error("Encryption resulted in an empty file.");const E=new Blob([p],{type:"application/pdf"});I(E,`encrypted-${l.file.name}`),a&&a.classList.add("hidden");let m="PDF encrypted successfully with 256-bit AES!";i||(m+=" Note: Without a separate owner password, the PDF has no usage restrictions."),f("Success",m,"success",()=>{w()})}catch(d){console.error("Error during PDF encryption:",d),a&&a.classList.add("hidden"),f("Encryption Failed",`An error occurred: ${d.message||"The PDF might be corrupted."}`)}finally{try{if(o?.FS){try{o.FS.unlink(n)}catch(d){console.warn("Failed to unlink input file:",d)}try{o.FS.unlink(r)}catch(d){console.warn("Failed to unlink output file:",d)}}}catch(d){console.warn("Failed to cleanup WASM FS:",d)}}}document.addEventListener("DOMContentLoaded",function(){const t=document.getElementById("file-input"),e=document.getElementById("drop-zone"),s=document.getElementById("process-btn"),i=document.getElementById("back-to-tools");i&&i.addEventListener("click",function(){window.location.href="/"}),t&&e&&(t.addEventListener("change",function(n){g(n.target.files)}),e.addEventListener("dragover",function(n){n.preventDefault(),e.classList.add("bg-gray-700")}),e.addEventListener("dragleave",function(n){n.preventDefault(),e.classList.remove("bg-gray-700")}),e.addEventListener("drop",function(n){n.preventDefault(),e.classList.remove("bg-gray-700");const r=n.dataTransfer?.files;if(r&&r.length>0){const o=Array.from(r).filter(function(a){return a.type==="application/pdf"||a.name.toLowerCase().endsWith(".pdf")});if(o.length>0){const a=new DataTransfer;a.items.add(o[0]),g(a.files)}}}),t.addEventListener("click",function(){t.value=""})),s&&s.addEventListener("click",P)});
