import{G as Ke,j as W,d as _e,c as Be,i as ke,g as Ze}from"./main-Dzxg2eZZ.js";import"./mobileMenu-CQFcDk7p.js";import"./full-width-CrKHpSp0.js";import"./simple-mode-footer-rW7ABm1-.js";import{P as Oe,S as Qe,r as S,T as ye,a as L,e as D,f as et,g as U}from"./PDFButton-_8Cap8jz.js";import{i as tt}from"./shortcuts-init-D4ylL1rf.js";import"./index-DMQTJy3b.js";Ke.workerSrc=new URL("/assets/pdf.worker.min-qwK7q_zL.mjs",import.meta.url).toString();let $=[],Y=null,Q=0,ge=new Set,ee=new Set,H=null,se=0,de=0,I=[],T=0,V=null,ot=null,Ee={width:612,height:792},Ne=1.333,ne={x:0,y:0},ie=1.333,te=!1,b=null,j=null,Se=0,Ie=0,X=0,J=0,Fe=0,$e=0,q=null;const w=document.getElementById("pdfCanvas"),Te=document.getElementById("propertiesPanel"),nt=document.getElementById("fieldCount"),Pe=document.getElementById("upload-area"),Ae=document.getElementById("tool-container"),oe=document.getElementById("dropZone"),it=document.getElementById("pdfFileInput"),at=document.getElementById("blankPdfBtn");document.getElementById("pdfUploadInput");const ze=document.getElementById("pageSizeSelector"),Le=document.getElementById("pageSizeSelect"),We=document.getElementById("customDimensionsInput"),rt=document.getElementById("customWidth"),lt=document.getElementById("customHeight"),st=document.getElementById("confirmBlankBtn"),dt=document.getElementById("pageIndicator"),Ue=document.getElementById("prevPageBtn"),Ge=document.getElementById("nextPageBtn"),ct=document.getElementById("addPageBtn"),pt=document.getElementById("resetBtn"),gt=document.getElementById("downloadBtn");document.getElementById("back-to-tools");const xe=document.getElementById("gotoPageInput"),ve=document.getElementById("gotoPageBtn"),R=document.getElementById("gridVInput"),M=document.getElementById("gridHInput"),N=document.getElementById("toggleGridBtn"),Ve=document.getElementById("enableGridCheckbox");let ce=2,pe=2,O=!1,_=!0;if(R&&M){R.value="2",M.value="2";const e=()=>{let n=parseInt(R.value)||2,l=parseInt(M.value)||2;n<2&&(n=2,R.value="2"),l<2&&(l=2,M.value="2"),n>14&&(n=14,R.value="14"),l>14&&(l=14,M.value="14"),ce=n,pe=l,O&&_&&re()};R.addEventListener("input",e),M.addEventListener("input",e)}Ve&&Ve.addEventListener("change",e=>{_=e.target.checked,_?(R&&(R.disabled=!1),M&&(M.disabled=!1),N&&(N.disabled=!1),O&&re()):(le(),R&&(R.disabled=!0),M&&(M.disabled=!0),N&&(N.disabled=!0))});N&&N.addEventListener("click",()=>{O=!O,O?(N.classList.add("bg-indigo-600"),N.classList.remove("bg-gray-600"),_&&re()):(N.classList.remove("bg-indigo-600"),N.classList.add("bg-gray-600"),le())});function re(){const e=document.getElementById("pdfGrid");e&&e.remove();const n=document.createElement("div");if(n.id="pdfGrid",n.className="absolute inset-0 pointer-events-none",n.style.zIndex="1",ce>0){const l=w.offsetWidth/ce;for(let i=0;i<=ce;i++){const o=document.createElement("div");o.className="absolute top-0 bottom-0 border-l-2 border-indigo-500 opacity-60",o.style.left=i*l+"px",n.appendChild(o)}}if(pe>0){const l=w.offsetHeight/pe;for(let i=0;i<=pe;i++){const o=document.createElement("div");o.className="absolute left-0 right-0 border-t-2 border-indigo-500 opacity-60",o.style.top=i*l+"px",n.appendChild(o)}}w.insertBefore(n,w.firstChild)}function le(){const e=document.getElementById("pdfGrid");e&&e.remove()}ve&&xe&&(ve.addEventListener("click",()=>{const e=parseInt(xe.value);!isNaN(e)&&e>=1&&e<=I.length?(T=e-1,Me(),he()):alert(`Please enter a valid page number between 1 and ${I.length}`)}),xe.addEventListener("keydown",e=>{e.key==="Enter"&&ve.click()}));const ue=document.querySelectorAll(".tool-item");ue.forEach(e=>{e.addEventListener("dragstart",o=>{if(o instanceof DragEvent&&o.dataTransfer){o.dataTransfer.effectAllowed="copy";const d=e.dataset.type||"text";o.dataTransfer.setData("text/plain",d),_&&re()}}),e.addEventListener("dragend",()=>{!O&&_&&le()}),e.addEventListener("click",()=>{const o=e.dataset.type||"text";q===o?(q=null,e.classList.remove("ring-2","ring-indigo-400","bg-indigo-600"),w.style.cursor="default"):(q&&ue.forEach(d=>d.classList.remove("ring-2","ring-indigo-400","bg-indigo-600")),q=o,e.classList.add("ring-2","ring-indigo-400","bg-indigo-600"),w.style.cursor="crosshair")});let n=0,l=0,i=!1;e.addEventListener("touchstart",o=>{const d=o.touches[0];n=d.clientX,l=d.clientY,i=!1}),e.addEventListener("touchmove",o=>{o.preventDefault();const d=o.touches[0],s=Math.abs(d.clientX-n),p=Math.abs(d.clientY-l);(s>10||p>10)&&(i=!0)}),e.addEventListener("touchend",o=>{if(o.preventDefault(),!i){e.click();return}const d=o.changedTouches[0],s=w.getBoundingClientRect();if(d.clientX>=s.left&&d.clientX<=s.right&&d.clientY>=s.top&&d.clientY<=s.bottom){const p=d.clientX-s.left-75,m=d.clientY-s.top-15,t=e.dataset.type||"text";De(t,p,m)}})});w.addEventListener("dragover",e=>{e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect="copy")});w.addEventListener("drop",e=>{e.preventDefault(),O||le();const n=w.getBoundingClientRect(),l=e.clientX-n.left-75,i=e.clientY-n.top-15,o=e.dataTransfer?.getData("text/plain")||"text";De(o,l,i)});w.addEventListener("click",e=>{if(q){const n=w.getBoundingClientRect(),l=e.clientX-n.left-75,i=e.clientY-n.top-15;De(q,l,i),ue.forEach(o=>o.classList.remove("ring-2","ring-indigo-400","bg-indigo-600")),q=null,w.style.cursor="default";return}e.target===w&&fe()});function De(e,n,l){Q++;const i={id:`field_${Q}`,type:e,x:Math.max(0,Math.min(n,666)),y:Math.max(0,Math.min(l,1026)),width:e==="checkbox"||e==="radio"?30:150,height:30,name:`${e.charAt(0).toUpperCase()+e.slice(1)}_${Q}`,defaultValue:"",fontSize:12,alignment:"left",textColor:"#000000",required:!1,readOnly:!1,tooltip:"",combCells:0,maxLength:0,options:e==="dropdown"||e==="optionlist"?["Option 1","Option 2","Option 3"]:void 0,checked:e==="radio"||e==="checkbox"?!1:void 0,exportValue:e==="radio"||e==="checkbox"?"Yes":void 0,groupName:e==="radio"?"RadioGroup1":void 0,label:e==="button"?"Button":e==="image"?"Click to Upload Image":void 0,action:e==="button"?"none":void 0,jsScript:e==="button"?'app.alert("Hello World!");':void 0,visibilityAction:e==="button"?"toggle":void 0,dateFormat:e==="date"?"mm/dd/yyyy":void 0,pageIndex:T,multiline:e==="text"?!1:void 0,borderColor:"#000000",hideBorder:!1};$.push(i),ae(i),Re()}function ae(e){const n=document.createElement("div");n.id=e.id,n.className="absolute cursor-move group",n.style.left=e.x+"px",n.style.top=e.y+"px",n.style.width=e.width+"px",n.style.overflow="visible",n.style.zIndex="10";const l=document.createElement("div");l.className="field-label absolute left-0 w-full text-xs font-semibold pointer-events-none select-none opacity-0 group-hover:opacity-100 transition-opacity",l.style.bottom="100%",l.style.marginBottom="4px",l.style.color="#374151",l.style.fontSize="11px",l.style.lineHeight="1",l.style.whiteSpace="nowrap",l.style.overflow="hidden",l.style.textOverflow="ellipsis",l.textContent=e.name;const i=document.createElement("div");i.className="field-container relative border-2 border-indigo-200 group-hover:border-dashed group-hover:border-indigo-300 bg-indigo-50/30 rounded transition-all",i.style.width="100%",i.style.height=e.height+"px";const o=document.createElement("div");if(o.className="field-content w-full h-full flex items-center justify-center overflow-hidden",e.type==="text")o.className="field-text w-full h-full flex items-center px-2 text-sm overflow-hidden",o.style.fontSize=e.fontSize+"px",o.style.textAlign=e.alignment,o.style.justifyContent=e.alignment==="left"?"flex-start":e.alignment==="right"?"flex-end":"center",o.style.color=e.textColor,o.style.whiteSpace=e.multiline?"pre-wrap":"nowrap",o.style.textOverflow="ellipsis",o.style.alignItems=e.multiline?"flex-start":"center",o.textContent=e.defaultValue,e.combCells>0&&(o.style.backgroundImage=`repeating-linear-gradient(90deg, transparent, transparent calc((100% / ${e.combCells}) - 1px), #e5e7eb calc((100% / ${e.combCells}) - 1px), #e5e7eb calc(100% / ${e.combCells}))`,o.style.fontFamily="monospace",o.style.letterSpacing=`calc(${e.width/e.combCells}px - 1ch)`,o.style.paddingLeft=`calc((${e.width/e.combCells}px - 1ch) / 2)`,o.style.overflow="hidden",o.style.textAlign="left",o.style.justifyContent="flex-start");else if(e.type==="checkbox")o.innerHTML=e.checked?'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-full h-full p-1"><polyline points="20 6 9 17 4 12"></polyline></svg>':"";else if(e.type==="radio")i.classList.add("rounded-full"),o.innerHTML=e.checked?'<div class="w-3/4 h-3/4 bg-black rounded-full"></div>':"";else if(e.type==="dropdown"){o.className="w-full h-full flex items-center px-2 text-sm text-black",o.style.backgroundColor="#e6f0ff";let s="Select...";e.defaultValue&&e.options&&e.options.includes(e.defaultValue)?s=e.defaultValue:e.options&&e.options.length>0&&(s=e.options[0]),o.textContent=s;const p=document.createElement("div");p.className="absolute right-1 top-1/2 -translate-y-1/2",p.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4"><path d="m6 9 6 6 6-6"/></svg>',i.appendChild(p)}else if(e.type==="optionlist")if(o.className="w-full h-full flex flex-col text-sm bg-white overflow-hidden border border-gray-300",e.options&&e.options.length>0)e.options.forEach((s,p)=>{const m=document.createElement("div");m.className="px-1 w-full truncate",m.textContent=s,(e.defaultValue?e.defaultValue===s:p===0)?m.className+=" bg-blue-600 text-white":m.className+=" text-black",o.appendChild(m)});else{const s=document.createElement("div");s.className="px-1 w-full text-black italic",s.textContent="Item 1",o.appendChild(s)}else e.type==="button"?(o.className="field-content w-full h-full flex items-center justify-center bg-gray-200 text-sm font-semibold",o.style.color=e.textColor||"#000000",o.textContent=e.label||"Button"):e.type==="signature"?(o.className="w-full h-full flex items-center justify-center bg-gray-50 text-gray-400",o.innerHTML='<div class="flex flex-col items-center"><i data-lucide="pen-tool" class="w-6 h-6 mb-1"></i><span class="text-[10px]">Sign Here</span></div>',setTimeout(()=>window.lucide?.createIcons(),0)):e.type==="date"?(o.className="w-full h-full flex items-center justify-center bg-white text-gray-600 border border-gray-300",o.innerHTML=`<div class="flex items-center gap-2 px-2"><i data-lucide="calendar" class="w-4 h-4"></i><span class="text-sm date-format-text">${e.dateFormat||"mm/dd/yyyy"}</span></div>`,setTimeout(()=>window.lucide?.createIcons(),0)):e.type==="image"&&(o.className="w-full h-full flex items-center justify-center bg-gray-100 text-gray-500 border border-gray-300",o.innerHTML=`<div class="flex flex-col items-center text-center p-1"><i data-lucide="image" class="w-6 h-6 mb-1"></i><span class="text-[10px] leading-tight">${e.label||"Click to Upload Image"}</span></div>`,setTimeout(()=>window.lucide?.createIcons(),0));i.appendChild(o),n.appendChild(l),n.appendChild(i),n.addEventListener("click",s=>{s.stopPropagation(),we(e)}),n.addEventListener("mousedown",s=>{if(s.target.classList.contains("resize-handle"))return;H=n;const p=w.getBoundingClientRect();se=s.clientX-p.left-e.x,de=s.clientY-p.top-e.y,we(e),_&&re(),s.preventDefault()}),n.addEventListener("touchstart",s=>{if(s.target.classList.contains("resize-handle"))return;const p=s.touches[0],m=w.getBoundingClientRect();se=p.clientX-m.left-e.x,de=p.clientY-m.top-e.y,we(e)},{passive:!0}),n.addEventListener("touchmove",s=>{s.preventDefault();const p=s.touches[0],m=w.getBoundingClientRect();let t=p.clientX-m.left-se,P=p.clientY-m.top-de;t=Math.max(0,Math.min(t,m.width-n.offsetWidth)),P=Math.max(0,Math.min(P,m.height-n.offsetHeight)),n.style.left=t+"px",n.style.top=P+"px",e.x=t,e.y=P}),n.addEventListener("touchend",()=>{}),["nw","ne","sw","se","n","s","e","w"].forEach(s=>{const p=document.createElement("div");p.className=`absolute w-2.5 h-2.5 bg-white border border-indigo-600 z-10 cursor-${s}-resize resize-handle hidden`;const m={nw:"top-0 left-0 -translate-x-1/2 -translate-y-1/2",ne:"top-0 right-0 translate-x-1/2 -translate-y-1/2",sw:"bottom-0 left-0 -translate-x-1/2 translate-y-1/2",se:"bottom-0 right-0 translate-x-1/2 translate-y-1/2",n:"top-0 left-1/2 -translate-x-1/2 -translate-y-1/2",s:"bottom-0 left-1/2 -translate-x-1/2 translate-y-1/2",e:"top-1/2 right-0 translate-x-1/2 -translate-y-1/2",w:"top-1/2 left-0 -translate-x-1/2 -translate-y-1/2"};p.className+=` ${m[s]}`,p.dataset.position=s,p.addEventListener("mousedown",t=>{t.stopPropagation(),je(t,e,s)}),p.addEventListener("touchstart",t=>{t.stopPropagation(),t.preventDefault();const P=t.touches[0],r={clientX:P.clientX,clientY:P.clientY,preventDefault:()=>{}};je(r,e,s)}),i.appendChild(p)}),w.appendChild(n)}function je(e,n,l){te=!0,b=n,j=l,Se=e.clientX,Ie=e.clientY,X=n.width,J=n.height,Fe=n.x,$e=n.y,e.preventDefault()}document.addEventListener("mousemove",e=>{if(H&&!te){const n=w.getBoundingClientRect();let l=e.clientX-n.left-se,i=e.clientY-n.top-de;l=Math.max(0,Math.min(l,n.width-H.offsetWidth)),i=Math.max(0,Math.min(i,n.height-H.offsetHeight)),H.style.left=l+"px",H.style.top=i+"px";const o=$.find(d=>d.id===H.id);o&&(o.x=l,o.y=i)}else if(te&&b){const n=e.clientX-Se,l=e.clientY-Ie,i=document.getElementById(b.id);if(j.includes("e")&&(b.width=Math.max(50,X+n)),j.includes("w")){const o=Math.max(50,X-n),d=X-o;b.width=o,b.x=Fe+d}if(j.includes("s")&&(b.height=Math.max(20,J+l)),j.includes("n")){const o=Math.max(20,J-l),d=J-o;b.height=o,b.y=$e+d}if(i){const o=i.querySelector(".field-container");if(i.style.width=b.width+"px",i.style.left=b.x+"px",i.style.top=b.y+"px",o&&(o.style.height=b.height+"px"),b.combCells>0){const d=i.querySelector(".field-text");d&&(d.style.letterSpacing=`calc(${b.width/b.combCells}px - 1ch)`,d.style.paddingLeft=`calc((${b.width/b.combCells}px - 1ch) / 2)`)}}}});document.addEventListener("mouseup",()=>{H=null,te=!1,b=null,O||le()});document.addEventListener("touchmove",e=>{const n=e.touches[0];if(te&&b){const l=n.clientX-Se,i=n.clientY-Ie,o=document.getElementById(b.id);if(j.includes("e")&&(b.width=Math.max(50,X+l)),j.includes("w")){const d=Math.max(50,X-l),s=X-d;b.width=d,b.x=Fe+s}if(j.includes("s")&&(b.height=Math.max(20,J+i)),j.includes("n")){const d=Math.max(20,J-i),s=J-d;b.height=d,b.y=$e+s}if(o){const d=o.querySelector(".field-container");if(o.style.width=b.width+"px",o.style.left=b.x+"px",o.style.top=b.y+"px",d&&(d.style.height=b.height+"px"),b.combCells>0){const s=o.querySelector(".field-text");s&&(s.style.letterSpacing=`calc(${b.width/b.combCells}px - 1ch)`,s.style.paddingLeft=`calc((${b.width/b.combCells}px - 1ch) / 2)`)}}}},{passive:!1});document.addEventListener("touchend",()=>{te=!1,b=null});function we(e){fe(),Y=e;const n=document.getElementById(e.id);if(n){const l=n.querySelector(".field-container"),i=n.querySelector(".field-label"),o=n.querySelectorAll(".resize-handle");l&&(l.classList.remove("border-indigo-200","group-hover:border-dashed","group-hover:border-indigo-300"),l.classList.add("border-dashed","border-indigo-500","bg-indigo-50")),i&&(i.classList.remove("opacity-0","group-hover:opacity-100"),i.classList.add("opacity-100")),o.forEach(d=>{d.classList.remove("hidden")})}ut(e)}function fe(){if(Y){const e=document.getElementById(Y.id);if(e){const n=e.querySelector(".field-container"),l=e.querySelector(".field-label"),i=e.querySelectorAll(".resize-handle");n&&(n.classList.remove("border-dashed","border-indigo-500","bg-indigo-50"),n.classList.add("border-indigo-200","group-hover:border-dashed","group-hover:border-indigo-300")),l&&(l.classList.remove("opacity-100"),l.classList.add("opacity-0","group-hover:opacity-100")),i.forEach(o=>{o.classList.add("hidden")})}Y=null}mt()}function ut(e){let n="";e.type==="text"?n=`
        <div>
            <label class="block text-xs font-semibold text-gray-300 mb-1">Value</label>
            <input type="text" id="propValue" value="${e.defaultValue}" ${e.combCells>0?`maxlength="${e.combCells}"`:e.maxLength>0?`maxlength="${e.maxLength}"`:""} class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500">
        </div>
        <div>
            <label class="block text-xs font-semibold text-gray-300 mb-1">Max Length (0 for unlimited)</label>
            <input type="number" id="propMaxLength" value="${e.maxLength}" min="0" ${e.combCells>0?"disabled":""} class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500 disabled:opacity-50">
        </div>
        <div>
            <label class="block text-xs font-semibold text-gray-300 mb-1">Divide into boxes (0 to disable)</label>
            <input type="number" id="propComb" value="${e.combCells}" min="0" class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500">
        </div>
        <div>
            <label class="block text-xs font-semibold text-gray-300 mb-1">Font Size</label>
            <input type="number" id="propFontSize" value="${e.fontSize}" min="8" max="72" class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500">
        </div>
        <div>
            <label class="block text-xs font-semibold text-gray-300 mb-1">Text Color</label>
            <input type="color" id="propTextColor" value="${e.textColor}" class="w-full border border-gray-500 rounded px-2 py-1 h-10">
        </div>
        <div>
            <label class="block text-xs font-semibold text-gray-300 mb-1">Alignment</label>
            <select id="propAlignment" class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500">
            <option value="left" ${e.alignment==="left"?"selected":""}>Left</option>
            <option value="center" ${e.alignment==="center"?"selected":""}>Center</option>
            <option value="right" ${e.alignment==="right"?"selected":""}>Right</option>
            </select>
        </div>
        <div class="flex items-center justify-between bg-gray-600 p-2 rounded mt-2">
            <label for="propMultiline" class="text-xs font-semibold text-gray-300">Multi-line</label>
            <button id="propMultilineBtn" class="w-12 h-6 rounded-full transition-colors duration-200 focus:outline-none ${e.multiline?"bg-indigo-600":"bg-gray-500"} relative">
                <span class="absolute top-1 left-1 bg-white w-4 h-4 rounded-full transition-transform duration-200 ${e.multiline?"translate-x-6":"translate-x-0"}"></span>
            </button>
        </div>
        `:e.type==="checkbox"?n=`
        <div class="flex items-center justify-between bg-gray-600 p-2 rounded">
            <label for="propChecked" class="text-xs font-semibold text-gray-300">Checked State</label>
            <button id="propCheckedBtn" class="w-12 h-6 rounded-full transition-colors duration-200 focus:outline-none ${e.checked?"bg-indigo-600":"bg-gray-500"} relative">
                <span class="absolute top-1 left-1 bg-white w-4 h-4 rounded-full transition-transform duration-200 ${e.checked?"translate-x-6":"translate-x-0"}"></span>
            </button>
        </div>
        `:e.type==="radio"?n=`
        <div>
            <label class="block text-xs font-semibold text-gray-300 mb-1">Group Name (Must be same for group)</label>
            <input type="text" id="propGroupName" value="${e.groupName}" class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500">
        </div>
        <div>
            <label class="block text-xs font-semibold text-gray-300 mb-1">Export Value</label>
            <input type="text" id="propExportValue" value="${e.exportValue}" class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500">
        </div>
        <div class="flex items-center justify-between bg-gray-600 p-2 rounded mt-2">
            <label for="propChecked" class="text-xs font-semibold text-gray-300">Checked State</label>
            <button id="propCheckedBtn" class="w-12 h-6 rounded-full transition-colors duration-200 focus:outline-none ${e.checked?"bg-indigo-600":"bg-gray-500"} relative">
                <span class="absolute top-1 left-1 bg-white w-4 h-4 rounded-full transition-transform duration-200 ${e.checked?"translate-x-6":"translate-x-0"}"></span>
            </button>
        </div>
        `:e.type==="dropdown"||e.type==="optionlist"?n=`
        <div>
            <label class="block text-xs font-semibold text-gray-300 mb-1">Options (One per line or comma separated)</label>
            <textarea id="propOptions" class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500 h-24">${e.options?.join(`
`)}</textarea>
        </div>
        <div>
            <label class="block text-xs font-semibold text-gray-300 mb-1">Selected Option</label>
            <select id="propSelectedOption" class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500">
                <option value="">None</option>
                ${e.options?.map(r=>`<option value="${r}" ${e.defaultValue===r?"selected":""}>${r}</option>`).join("")}
            </select>
        </div>
        <div class="text-xs text-gray-400 italic mt-2">
            To actually fill or change the options, use our PDF Form Filler tool.
        </div>
        `:e.type==="button"?n=`
        <div>
            <label class="block text-xs font-semibold text-gray-300 mb-1">Label</label>
            <input type="text" id="propLabel" value="${e.label}" class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500">
        </div>
        <div>
            <label class="block text-xs font-semibold text-gray-300 mb-1">Action</label>
            <select id="propAction" class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500">
                <option value="none" ${e.action==="none"?"selected":""}>None</option>
                <option value="reset" ${e.action==="reset"?"selected":""}>Reset Form</option>
                <option value="print" ${e.action==="print"?"selected":""}>Print Form</option>
                <option value="url" ${e.action==="url"?"selected":""}>Open URL</option>
                <option value="js" ${e.action==="js"?"selected":""}>Run Javascript</option>
                <option value="showHide" ${e.action==="showHide"?"selected":""}>Show/Hide Field</option>
            </select>
        </div>
        <div id="propUrlContainer" class="${e.action==="url"?"":"hidden"}">
            <label class="block text-xs font-semibold text-gray-300 mb-1">URL</label>
            <input type="text" id="propActionUrl" value="${e.actionUrl||""}" placeholder="https://example.com" class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500">
        </div>
        <div id="propJsContainer" class="${e.action==="js"?"":"hidden"}">
            <label class="block text-xs font-semibold text-gray-300 mb-1">Javascript Code</label>
            <textarea id="propJsScript" class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500 h-24 font-mono">${e.jsScript||""}</textarea>
        </div>
        <div id="propShowHideContainer" class="${e.action==="showHide"?"":"hidden"}">
            <div class="mb-2">
                <label class="block text-xs font-semibold text-gray-300 mb-1">Target Field</label>
                <select id="propTargetField" class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500">
                    <option value="">Select a field...</option>
                    ${$.filter(r=>r.id!==e.id).map(r=>`<option value="${r.name}" ${e.targetFieldName===r.name?"selected":""}>${r.name} (${r.type})</option>`).join("")}
                </select>
            </div>
            <div>
                <label class="block text-xs font-semibold text-gray-300 mb-1">Visibility</label>
                <select id="propVisibilityAction" class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500">
                    <option value="show" ${e.visibilityAction==="show"?"selected":""}>Show</option>
                    <option value="hide" ${e.visibilityAction==="hide"?"selected":""}>Hide</option>
                    <option value="toggle" ${e.visibilityAction==="toggle"?"selected":""}>Toggle</option>
                </select>
            </div>
        </div>
        `:e.type==="signature"?n=`
        <div class="text-xs text-gray-400 italic mb-2">
            Signature fields are AcroForm signature fields and would only be visible in an advanced PDF viewer.
        </div>
        `:e.type==="date"?n=`
        <div>
            <label class="block text-xs font-semibold text-gray-300 mb-1">Date Format</label>
            <select id="propDateFormat" class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500">
                ${["mm/dd/yyyy","dd/mm/yyyy","mm/yy","dd/mm/yy","yyyy/mm/dd","mmm d, yyyy","d-mmm-yy","yy-mm-dd"].map(u=>`<option value="${u}" ${e.dateFormat===u?"selected":""}>${u}</option>`).join("")}
            </select>
        </div>
        <div class="text-xs text-gray-400 italic mt-2">
            The selected format will be enforced when the user types or picks a date.
        </div>
        <div class="bg-blue-900/30 border border-blue-700/50 rounded p-2 mt-2">
            <p class="text-xs text-blue-200 flex gap-2">
                <i data-lucide="info" class="w-4 h-4 flex-shrink-0"></i>
                <span><strong>Browser Note:</strong> Firefox and Chrome may show their native date picker format during selection. The correct format will apply when you finish entering the date. This is normal browser behavior and not an issue.</span>
            </p>
        </div>
        `:e.type==="image"&&(n=`
        <div>
            <label class="block text-xs font-semibold text-gray-300 mb-1">Label / Prompt</label>
            <input type="text" id="propLabel" value="${e.label}" class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500">
        </div>
        <div class="text-xs text-gray-400 italic mt-2">
            Clicking this field in the PDF will open a file picker to upload an image.
        </div>
        `),Te.innerHTML=`
    <div class="space-y-3">
      <div>
        <label class="block text-xs font-semibold text-gray-300 mb-1">Field Name ${e.type==="radio"?"(Group Name)":""}</label>
        <input type="text" id="propName" value="${e.name}" class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500">
        <div id="nameError" class="hidden text-red-400 text-xs mt-1"></div>
      </div>
      ${e.type==="radio"&&(ee.size>0||$.some(r=>r.type==="radio"&&r.id!==e.id))?`
      <div>
        <label class="block text-xs font-semibold text-gray-300 mb-1">Existing Radio Groups</label>
        <select id="existingGroups" class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500">
          <option value="">-- Select existing group --</option>
          ${Array.from(ee).map(r=>`<option value="${r}">${r}</option>`).join("")}
          ${Array.from(new Set($.filter(r=>r.type==="radio"&&r.id!==e.id).map(r=>r.name))).map(r=>ee.has(r)?"":`<option value="${r}">${r}</option>`).join("")}
        </select>
        <p class="text-xs text-gray-400 mt-1">Select to add this button to an existing group</p>
      </div>
      `:""}
      ${n}
      <div>
        <label class="block text-xs font-semibold text-gray-300 mb-1">Tooltip / Help Text</label>
        <input type="text" id="propTooltip" value="${e.tooltip}" placeholder="Description for screen readers" class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500">
      </div>
      <div class="flex items-center">
        <input type="checkbox" id="propRequired" ${e.required?"checked":""} class="mr-2">
        <label for="propRequired" class="text-xs font-semibold text-gray-300">Required</label>
      </div>
      <div class="flex items-center">
        <input type="checkbox" id="propReadOnly" ${e.readOnly?"checked":""} class="mr-2">
        <label for="propReadOnly" class="text-xs font-semibold text-gray-300">Read Only</label>
      </div>
      <div>
        <label class="block text-xs font-semibold text-gray-300 mb-1">Border Color</label>
        <input type="color" id="propBorderColor" value="${e.borderColor||"#000000"}" class="w-full border border-gray-500 rounded px-2 py-1 h-10">
      </div>
      <div class="flex items-center">
        <input type="checkbox" id="propHideBorder" ${e.hideBorder?"checked":""} class="mr-2">
        <label for="propHideBorder" class="text-xs font-semibold text-gray-300">Hide Border</label>
      </div>
      <button id="deleteBtn" class="w-full bg-red-600 text-white py-2 rounded hover:bg-red-700 transition text-sm font-semibold">
        Delete Field
      </button>
    </div>
  `;const l=document.getElementById("propName"),i=document.getElementById("nameError"),o=document.getElementById("propTooltip"),d=document.getElementById("propRequired"),s=document.getElementById("propReadOnly"),p=document.getElementById("deleteBtn"),m=r=>{if(!r)return i.textContent="Field name cannot be empty",i.classList.remove("hidden"),l.classList.add("border-red-500"),!1;if(e.type==="radio")return i.classList.add("hidden"),l.classList.remove("border-red-500"),!0;const u=$.some(x=>x.id!==e.id&&x.name===r),h=ge.has(r);return u||h?(i.textContent=`Field name "${r}" already exists in this ${h?"PDF":"form"}. Please try using a unique name.`,i.classList.remove("hidden"),l.classList.add("border-red-500"),!1):(i.classList.add("hidden"),l.classList.remove("border-red-500"),!0)};if(l.addEventListener("input",r=>{const u=r.target.value.trim();m(u)}),l.addEventListener("change",r=>{const u=r.target.value.trim();if(!m(u)){r.target.value=e.name;return}e.name=u;const h=document.getElementById(e.id);if(h){const x=h.querySelector(".field-label");x&&(x.textContent=e.name)}}),o.addEventListener("input",r=>{e.tooltip=r.target.value}),e.type==="radio"){const r=document.getElementById("existingGroups");r&&r.addEventListener("change",u=>{const h=u.target.value;if(h){l.value=h,e.name=h,m(h);const x=document.getElementById(e.id);if(x){const k=x.querySelector(".field-label");k&&(k.textContent=e.name)}}})}d.addEventListener("change",r=>{e.required=r.target.checked}),s.addEventListener("change",r=>{e.readOnly=r.target.checked});const t=document.getElementById("propBorderColor"),P=document.getElementById("propHideBorder");if(t.addEventListener("input",r=>{e.borderColor=r.target.value}),P.addEventListener("change",r=>{e.hideBorder=r.target.checked}),p.addEventListener("click",()=>{Ye(e)}),e.type==="text"){const r=document.getElementById("propValue"),u=document.getElementById("propMaxLength"),h=document.getElementById("propComb"),x=document.getElementById("propFontSize"),k=document.getElementById("propTextColor"),B=document.getElementById("propAlignment");r.addEventListener("input",y=>{e.defaultValue=y.target.value;const f=document.getElementById(e.id);if(f){const c=f.querySelector(".field-text");c&&(c.textContent=e.defaultValue)}}),u.addEventListener("input",y=>{const f=parseInt(y.target.value);if(e.maxLength=isNaN(f)?0:Math.max(0,f),e.maxLength>0){if(r.maxLength=e.maxLength,e.defaultValue.length>e.maxLength){e.defaultValue=e.defaultValue.substring(0,e.maxLength),r.value=e.defaultValue;const c=document.getElementById(e.id);if(c){const a=c.querySelector(".field-text");a&&(a.textContent=e.defaultValue)}}}else r.removeAttribute("maxLength")}),h.addEventListener("input",y=>{const f=parseInt(y.target.value);e.combCells=isNaN(f)?0:Math.max(0,f),e.combCells>0?(r.maxLength=e.combCells,u.value=e.combCells.toString(),u.disabled=!0,e.maxLength=e.combCells,e.defaultValue.length>e.combCells&&(e.defaultValue=e.defaultValue.substring(0,e.combCells),r.value=e.defaultValue)):(u.disabled=!1,r.removeAttribute("maxLength"),e.maxLength>0&&(r.maxLength=e.maxLength));const c=document.getElementById(e.id);if(c){const a=c.querySelector(".field-text");a&&(a.textContent=e.defaultValue,e.combCells>0?(a.style.backgroundImage=`repeating-linear-gradient(90deg, transparent, transparent calc((100% / ${e.combCells}) - 1px), #e5e7eb calc((100% / ${e.combCells}) - 1px), #e5e7eb calc(100% / ${e.combCells}))`,a.style.fontFamily="monospace",a.style.letterSpacing=`calc(${e.width/e.combCells}px - 1ch)`,a.style.paddingLeft=`calc((${e.width/e.combCells}px - 1ch) / 2)`,a.style.overflow="hidden",a.style.textAlign="left",a.style.justifyContent="flex-start"):(a.style.backgroundImage="none",a.style.fontFamily="inherit",a.style.letterSpacing="normal",a.style.textAlign=e.alignment,a.style.justifyContent=e.alignment==="left"?"flex-start":e.alignment==="right"?"flex-end":"center"))}}),x.addEventListener("input",y=>{e.fontSize=parseInt(y.target.value);const f=document.getElementById(e.id);if(f){const c=f.querySelector(".field-text");c&&(c.style.fontSize=e.fontSize+"px")}}),k.addEventListener("input",y=>{e.textColor=y.target.value;const f=document.getElementById(e.id);if(f){const c=f.querySelector(".field-text");c&&(c.style.color=e.textColor)}}),B.addEventListener("change",y=>{e.alignment=y.target.value;const f=document.getElementById(e.id);if(f){const c=f.querySelector(".field-text");c&&(c.style.textAlign=e.alignment,c.style.justifyContent=e.alignment==="left"?"flex-start":e.alignment==="right"?"flex-end":"center")}});const v=document.getElementById("propMultilineBtn");v&&v.addEventListener("click",()=>{e.multiline=!e.multiline;const y=v.querySelector("span");e.multiline?(v.classList.remove("bg-gray-500"),v.classList.add("bg-indigo-600"),y?.classList.remove("translate-x-0"),y?.classList.add("translate-x-6")):(v.classList.remove("bg-indigo-600"),v.classList.add("bg-gray-500"),y?.classList.remove("translate-x-6"),y?.classList.add("translate-x-0"));const f=document.getElementById(e.id);if(f){const c=f.querySelector(".field-text");c&&(e.multiline?(c.style.whiteSpace="pre-wrap",c.style.alignItems="flex-start",c.style.overflow="hidden"):(c.style.whiteSpace="nowrap",c.style.alignItems="center",c.style.overflow="hidden"))}})}else if(e.type==="checkbox"||e.type==="radio"){const r=document.getElementById("propCheckedBtn");if(r.addEventListener("click",()=>{e.checked=!e.checked;const u=r.querySelector("span");e.checked?(r.classList.remove("bg-gray-500"),r.classList.add("bg-indigo-600"),u?.classList.remove("translate-x-0"),u?.classList.add("translate-x-6")):(r.classList.remove("bg-indigo-600"),r.classList.add("bg-gray-500"),u?.classList.remove("translate-x-6"),u?.classList.add("translate-x-0"));const h=document.getElementById(e.id);if(h){const x=h.querySelector(".field-content");x&&(e.type==="checkbox"?x.innerHTML=e.checked?'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-full h-full p-1"><polyline points="20 6 9 17 4 12"></polyline></svg>':"":x.innerHTML=e.checked?'<div class="w-3/4 h-3/4 bg-black rounded-full"></div>':"")}}),e.type==="radio"){const u=document.getElementById("propGroupName"),h=document.getElementById("propExportValue");u.addEventListener("input",x=>{e.groupName=x.target.value}),h.addEventListener("input",x=>{e.exportValue=x.target.value})}}else if(e.type==="dropdown"||e.type==="optionlist")document.getElementById("propOptions").addEventListener("input",h=>{const x=h.target.value;e.options=x.split(/[\n,]/).map(B=>B.trim()).filter(B=>B.length>0);const k=document.getElementById("propSelectedOption");if(k){const B=e.defaultValue;k.innerHTML='<option value="">None</option>'+e.options?.map(v=>`<option value="${v}" ${B===v?"selected":""}>${v}</option>`).join(""),B&&e.options&&!e.options.includes(B)&&(e.defaultValue="",k.value="")}ae(e)}),document.getElementById("propSelectedOption").addEventListener("change",h=>{e.defaultValue=h.target.value,ae(e)});else if(e.type==="button"){document.getElementById("propLabel").addEventListener("input",c=>{e.label=c.target.value;const a=document.getElementById(e.id);if(a){const g=a.querySelector(".field-content");g&&(g.textContent=e.label||"Button")}});const u=document.getElementById("propAction"),h=document.getElementById("propUrlContainer"),x=document.getElementById("propJsContainer"),k=document.getElementById("propShowHideContainer");u.addEventListener("change",c=>{e.action=c.target.value,h.classList.add("hidden"),x.classList.add("hidden"),k.classList.add("hidden"),e.action==="url"?h.classList.remove("hidden"):e.action==="js"?x.classList.remove("hidden"):e.action==="showHide"&&k.classList.remove("hidden")}),document.getElementById("propActionUrl").addEventListener("input",c=>{e.actionUrl=c.target.value});const v=document.getElementById("propJsScript");v&&v.addEventListener("input",c=>{e.jsScript=c.target.value});const y=document.getElementById("propTargetField");y&&y.addEventListener("change",c=>{e.targetFieldName=c.target.value});const f=document.getElementById("propVisibilityAction");f&&f.addEventListener("change",c=>{e.visibilityAction=c.target.value})}else if(e.type!=="signature")if(e.type==="date"){const r=document.getElementById("propDateFormat");r&&r.addEventListener("change",u=>{e.dateFormat=u.target.value;const h=document.getElementById(e.id);if(h){const x=h.querySelector(".date-format-text");x&&(x.textContent=e.dateFormat)}setTimeout(()=>window.lucide?.createIcons(),0)})}else e.type==="image"&&document.getElementById("propLabel").addEventListener("input",u=>{e.label=u.target.value,ae(e)})}function mt(){Te.innerHTML='<p class="text-gray-500 text-sm">Select a field to edit properties</p>'}function Ye(e){const n=document.getElementById(e.id);n&&n.remove(),$=$.filter(l=>l.id!==e.id),fe(),Re()}document.addEventListener("keydown",e=>{e.key==="Delete"&&Y?Ye(Y):e.key==="Escape"&&q&&(ue.forEach(n=>n.classList.remove("ring-2","ring-indigo-400","bg-indigo-600")),q=null,w.style.cursor="default")});function Re(){nt.textContent=$.length.toString()}gt.addEventListener("click",async()=>{const e=new Map,n=[],l=[];if($.forEach(i=>{const o=e.get(i.name)||0;e.set(i.name,o+1),ge.has(i.name)&&(i.type==="radio"&&ee.has(i.name)||l.push(i.name))}),e.forEach((i,o)=>{i>1&&($.filter(p=>p.name===o).every(p=>p.type==="radio")||n.push(o))}),l.length>0){const i=[...new Set(l)].map(o=>`"${o}"`).join(", ");Z("Field Name Conflict",`The following field names already exist in the uploaded PDF: ${i}. Please rename these fields before downloading.`,"error");return}if(n.length>0){const i=n.map(o=>`"${o}"`).join(", ");Z("Duplicate Field Names",`The following field names are used more than once: ${i}. Please rename these fields to use unique names before downloading.`,"error");return}if($.length===0){alert("Please add at least one field before downloading.");return}if(I.length===0){alert("No pages found. Please create a blank PDF or upload one.");return}try{let i;if(V)i=V;else{i=await Oe.create();for(const t of I)i.addPage([t.width,t.height])}const o=i.getForm(),d=await i.embedFont(Qe.Helvetica);i.setTitle("Fillable Form"),i.setAuthor("BentoPDF"),i.setLanguage("en-US");const s=new Map;for(const t of $){if(!I[t.pageIndex])continue;const r=i.getPage(t.pageIndex),{height:u}=r.getSize(),h=1/ie,x=1/ie,k=t.x-ne.x,B=t.y-ne.y,v=k*h,y=u-B*x-t.height*x,f=t.width*h,c=t.height*x;if(console.log(`Field "${t.name}":`,{screenPos:{x:t.x,y:t.y},adjustedPos:{x:k,y:B},pdfPos:{x:v,y,width:f,height:c},metrics:{offset:ne,scale:ie}}),t.type==="text"){const a=o.createTextField(t.name),g=W(t.textColor),E=W(t.borderColor||"#000000");a.addToPage(r,{x:v,y,width:f,height:c,borderWidth:t.hideBorder?0:1,borderColor:S(E.r,E.g,E.b),backgroundColor:S(1,1,1),textColor:S(g.r,g.g,g.b)}),a.setText(t.defaultValue),a.setFontSize(t.fontSize),t.alignment==="center"?a.setAlignment(ye.Center):t.alignment==="right"?a.setAlignment(ye.Right):a.setAlignment(ye.Left),t.combCells>0?(a.setMaxLength(t.combCells),a.enableCombing()):t.maxLength>0&&a.setMaxLength(t.maxLength),t.multiline?a.enableMultiline():a.disableMultiline(),t.required&&a.enableRequired(),t.readOnly&&a.enableReadOnly(),t.tooltip&&a.acroField.getWidgets().forEach(C=>{C.dict.set(L.of("TU"),D.of(t.tooltip))})}else if(t.type==="checkbox"){const a=o.createCheckBox(t.name),g=W(t.borderColor||"#000000");a.addToPage(r,{x:v,y,width:f,height:c,borderWidth:t.hideBorder?0:1,borderColor:S(g.r,g.g,g.b),backgroundColor:S(1,1,1)}),t.checked&&a.check(),t.required&&a.enableRequired(),t.readOnly&&a.enableReadOnly(),t.tooltip&&a.acroField.getWidgets().forEach(E=>{E.dict.set(L.of("TU"),D.of(t.tooltip))})}else if(t.type==="radio"){const a=t.name;let g;if(s.has(a))g=s.get(a);else{const C=o.getFieldMaybe(a);C?(g=C,s.set(a,g),console.log(`Using existing radio group from PDF: ${a}`)):(g=o.createRadioGroup(a),s.set(a,g),console.log(`Created new radio group: ${a}`))}const E=W(t.borderColor||"#000000");g.addOptionToPage(t.exportValue||"Yes",r,{x:v,y,width:f,height:c,borderWidth:t.hideBorder?0:1,borderColor:S(E.r,E.g,E.b),backgroundColor:S(1,1,1)}),t.checked&&g.select(t.exportValue||"Yes"),t.required&&g.enableRequired(),t.readOnly&&g.enableReadOnly(),t.tooltip&&g.acroField.getWidgets().forEach(C=>{C.dict.set(L.of("TU"),D.of(t.tooltip))})}else if(t.type==="dropdown"){const a=o.createDropdown(t.name),g=W(t.borderColor||"#000000");a.addToPage(r,{x:v,y,width:f,height:c,borderWidth:t.hideBorder?0:1,borderColor:S(g.r,g.g,g.b),backgroundColor:S(1,1,1)}),t.options&&a.setOptions(t.options),t.defaultValue&&t.options?.includes(t.defaultValue)?a.select(t.defaultValue):t.options&&t.options.length>0&&a.select(t.options[0]);const E=W(t.textColor);a.acroField.setFontSize(t.fontSize),a.acroField.setDefaultAppearance(`0 0 0 rg /Helv ${t.fontSize} Tf`),t.required&&a.enableRequired(),t.readOnly&&a.enableReadOnly(),t.tooltip&&a.acroField.getWidgets().forEach(C=>{C.dict.set(L.of("TU"),D.of(t.tooltip))})}else if(t.type==="optionlist"){const a=o.createOptionList(t.name),g=W(t.borderColor||"#000000");a.addToPage(r,{x:v,y,width:f,height:c,borderWidth:t.hideBorder?0:1,borderColor:S(g.r,g.g,g.b),backgroundColor:S(1,1,1)}),t.options&&a.setOptions(t.options),t.defaultValue&&t.options?.includes(t.defaultValue)?a.select(t.defaultValue):t.options&&t.options.length>0&&a.select(t.options[0]);const E=W(t.textColor);a.acroField.setFontSize(t.fontSize),a.acroField.setDefaultAppearance(`0 0 0 rg /Helv ${t.fontSize} Tf`),t.required&&a.enableRequired(),t.readOnly&&a.enableReadOnly(),t.tooltip&&a.acroField.getWidgets().forEach(C=>{C.dict.set(L.of("TU"),D.of(t.tooltip))})}else if(t.type==="button"){const a=o.createButton(t.name),g=W(t.borderColor||"#000000");a.addToPage(t.label||"Button",r,{x:v,y,width:f,height:c,borderWidth:t.hideBorder?0:1,borderColor:S(g.r,g.g,g.b),backgroundColor:S(.8,.8,.8)}),t.action&&t.action!=="none"&&a.acroField.getWidgets().forEach(C=>{let A;if(t.action==="reset")A=i.context.obj({Type:"Action",S:"ResetForm"});else if(t.action==="print")A=i.context.obj({Type:"Action",S:"JavaScript",JS:"print();"});else if(t.action==="url"&&t.actionUrl){let F=t.actionUrl.trim();!F.startsWith("http://")&&!F.startsWith("https://")&&(F="https://"+F);try{F=encodeURI(F)}catch(z){console.warn("Failed to encode URL:",z)}A=i.context.obj({Type:"Action",S:"URI",URI:D.of(F)})}else if(t.action==="js"&&t.jsScript)A=i.context.obj({Type:"Action",S:"JavaScript",JS:t.jsScript});else if(t.action==="showHide"&&t.targetFieldName){const F=t.targetFieldName;let z="";t.visibilityAction==="show"?z=`var f = this.getField("${F}"); if(f) f.display = display.visible;`:t.visibilityAction==="hide"?z=`var f = this.getField("${F}"); if(f) f.display = display.hidden;`:z=`var f = this.getField("${F}"); if(f) f.display = (f.display === display.visible) ? display.hidden : display.visible;`,A=i.context.obj({Type:"Action",S:"JavaScript",JS:z})}A&&C.dict.set(L.of("A"),A)}),t.tooltip&&a.acroField.getWidgets().forEach(E=>{E.dict.set(L.of("TU"),D.of(t.tooltip))})}else if(t.type==="date"){const a=o.createTextField(t.name);a.addToPage(r,{x:v,y,width:f,height:c,borderWidth:1,borderColor:S(0,0,0),backgroundColor:S(1,1,1)});const g=t.dateFormat||"mm/dd/yyyy",E=i.context.obj({Type:"Action",S:"JavaScript",JS:D.of(`AFDate_FormatEx("${g}");`)}),C=i.context.obj({Type:"Action",S:"JavaScript",JS:D.of(`AFDate_KeystrokeEx("${g}");`)}),A=i.context.obj({F:E,K:C});a.acroField.dict.set(L.of("AA"),A),t.required&&a.enableRequired(),t.readOnly&&a.enableReadOnly(),t.tooltip&&a.acroField.getWidgets().forEach(F=>{F.dict.set(L.of("TU"),D.of(t.tooltip))})}else if(t.type==="image"){const a=o.createButton(t.name);a.addToPage(t.label||"Click to Upload Image",r,{x:v,y,width:f,height:c,borderWidth:1,borderColor:S(0,0,0),backgroundColor:S(.9,.9,.9)}),a.acroField.getWidgets().forEach(E=>{const C=i.context.obj({Type:"Action",S:"JavaScript",JS:"event.target.buttonImportIcon();"});E.dict.set(L.of("A"),C);const A=i.context.obj({TP:1,BG:[.9,.9,.9],BC:[0,0,0],IF:{SW:L.of("A"),S:L.of("A"),FB:!0}});E.dict.set(L.of("MK"),A)}),t.tooltip&&a.acroField.getWidgets().forEach(E=>{E.dict.set(L.of("TU"),D.of(t.tooltip))})}else if(t.type==="signature"){const a=i.context,g=a.obj({FT:L.of("Sig"),T:D.of(t.name),Kids:[]}),E=a.register(g),C=a.obj({Type:L.of("Annot"),Subtype:L.of("Widget"),Rect:[v,y,v+f,y+c],F:4,P:r.ref,Parent:E}),A=a.obj({W:1,S:L.of("S")});C.set(L.of("BS"),A),C.set(L.of("BC"),a.obj([0,0,0])),C.set(L.of("BG"),a.obj([.95,.95,.95]));const F=a.register(C);g.get(L.of("Kids")).push(F),r.node.addAnnot(F),o.acroForm.addField(E),t.tooltip&&C.set(L.of("TU"),D.of(t.tooltip))}}o.updateFieldAppearances(d);const p=await i.save(),m=new Blob([new Uint8Array(p)],{type:"application/pdf"});_e(m,"fillable-form.pdf"),Z("Success","Your PDF has been downloaded successfully.","info",()=>{Ce()},"Okay")}catch(i){console.error("Error generating PDF:",i);const o=i.message;if(o.includes("A field already exists with the specified name")){const d=o.match(/A field already exists with the specified name: "(.+?)"/),s=d?d[1]:"unknown";ee.has(s)?console.log(`Adding to existing radio group: ${s}`):Z("Duplicate Field Name",`A field named "${s}" already exists. Please rename this field to use a unique name before downloading.`,"error")}else Z("Error","Error generating PDF: "+o,"error")}});const ft=document.querySelectorAll('[id^="back-to-tools"]');ft.forEach(e=>{e.addEventListener("click",()=>{window.location.href="/"})});function bt(e){let n;switch(e){case"letter":n=U.Letter;break;case"a4":n=U.A4;break;case"a5":n=U.A5;break;case"legal":n=U.Legal;break;case"tabloid":n=U.Tabloid;break;case"a3":n=U.A3;break;case"custom":const l=parseInt(rt.value)||612,i=parseInt(lt.value)||792;return{width:l,height:i};default:n=U.Letter}return{width:n[0],height:n[1]}}function Ce(){$=[],I=[],T=0,V=null,Y=null,w.innerHTML="",Te.innerHTML='<p class="text-gray-500 text-sm">Select a field to edit properties</p>',Re(),Pe.classList.remove("hidden"),Ae.classList.add("hidden"),ze.classList.add("hidden"),setTimeout(()=>Be({icons:ke}),100)}function Xe(){I.push({index:I.length,width:Ee.width,height:Ee.height}),he()}function be(e){e<0||e>=I.length||(T=e,Me(),he(),fe())}async function Me(){const e=I[T];if(!e)return;let n=1.333;Ne=n;const l=e.width*n,i=e.height*n;if(w.style.width=`${l}px`,w.style.height=`${i}px`,w.innerHTML="",V)try{const o=await V.save(),d=new Blob([o.buffer],{type:"application/pdf"}),s=URL.createObjectURL(d),p=document.createElement("iframe");p.src=`/pdfjs-viewer/viewer.html?file=${encodeURIComponent(s)}#page=${T+1}&toolbar=0`,p.style.width="100%",p.style.height=`${i}px`,p.style.border="none",p.style.position="absolute",p.style.top="0",p.style.left="0",p.style.pointerEvents="none",p.style.opacity="0.8",p.onload=()=>{try{const m=p.contentWindow;if(m&&m.PDFViewerApplication){const t=m.PDFViewerApplication,P=m.document.createElement("style");P.textContent=`
                            * {
                                margin: 0 !important;
                                padding: 0 !important;
                            }
                            html, body {
                                margin: 0 !important;
                                padding: 0 !important;
                                background-color: transparent !important;
                                overflow: hidden !important;
                            }
                            #toolbarContainer {
                                display: none !important;
                            }
                            #mainContainer {
                                top: 0 !important;
                                position: absolute !important;
                                left: 0 !important;
                                margin: 0 !important;
                                padding: 0 !important;
                            }
                            #outerContainer {
                                background-color: transparent !important;
                                margin: 0 !important;
                                padding: 0 !important;
                            }
                            #viewerContainer {
                                top: 0 !important;
                                background-color: transparent !important;
                                overflow: hidden !important;
                                margin: 0 !important;
                                padding: 0 !important;
                            }
                            .toolbar {
                                display: none !important;
                            }
                            .pdfViewer {
                                padding: 0 !important;
                                margin: 0 !important;
                            }
                            .page {
                                margin: 0 !important;
                                padding: 0 !important;
                                border: none !important;
                                box-shadow: none !important;
                            }
                        `,m.document.head.appendChild(P);const r=setInterval(()=>{if(t.pdfViewer&&t.pdfViewer.pagesCount>0){clearInterval(r);const u=m.document.querySelector(".page");if(u){const h=u.getBoundingClientRect(),x=-h.left,k=-h.top;u.style.transform=`translate(${x}px, ${k}px)`,setTimeout(()=>{const B=u.getBoundingClientRect(),v=m.getComputedStyle(u),y=parseFloat(v.borderLeftWidth)||0,f=parseFloat(v.borderTopWidth)||0,c=parseFloat(v.borderRightWidth)||0;ne={x:B.left+y,y:B.top+f},ie=(B.width-y-c)/e.width,console.log(" Calibrated Metrics (force positioned):",{initialPosition:{left:h.left,top:h.top},appliedTransform:{x,y:k},finalRect:{left:B.left,top:B.top,width:B.width,height:B.height},computedBorders:{left:y,top:f,right:c},finalOffset:ne,finalScale:ie,pdfDimensions:{width:e.width,height:e.height}})},50)}}},100)}}catch(m){console.error("Error accessing iframe content:",m)}},w.appendChild(p),console.log("Canvas dimensions:",{width:l,height:i,scale:Ne}),console.log("PDF page dimensions:",{width:e.width,height:e.height})}catch(o){console.error("Error rendering PDF:",o)}$.filter(o=>o.pageIndex===T).forEach(o=>{ae(o)})}function he(){dt.textContent=`Page ${T+1} of ${I.length}`,Ue.disabled=T===0,Ge.disabled=T===I.length-1}oe.addEventListener("dragover",e=>{e.preventDefault(),oe.classList.add("border-indigo-500","bg-gray-600")});oe.addEventListener("dragleave",()=>{oe.classList.remove("border-indigo-500","bg-gray-600")});oe.addEventListener("drop",e=>{e.preventDefault(),oe.classList.remove("border-indigo-500","bg-gray-600");const n=e.dataTransfer?.files;n&&n.length>0&&n[0].type==="application/pdf"&&Je(n[0])});it.addEventListener("change",async e=>{const n=e.target.files?.[0];n&&Je(n)});at.addEventListener("click",()=>{ze.classList.remove("hidden")});Le.addEventListener("change",()=>{Le.value==="custom"?We.classList.remove("hidden"):We.classList.add("hidden")});st.addEventListener("click",()=>{const e=Le.value;Ee=bt(e),Xe(),be(0),Pe.classList.add("hidden"),Ae.classList.remove("hidden"),setTimeout(()=>Be({icons:ke}),100)});async function Je(e){try{const n=await e.arrayBuffer();V=await Oe.load(n),ge.clear();try{V.getForm().getFields().forEach(d=>{const s=d.getName();ge.add(s),d instanceof et&&ee.add(s);const p=s.match(/([a-zA-Z]+)_(\d+)/);if(p){const m=parseInt(p[2]);!isNaN(m)&&m>Q&&(Q=m,console.log("     Updated field counter to:",Q))}})}catch(i){console.log("No form fields found or error reading fields:",i)}ot=await Ze({data:n}).promise;const l=V.getPageCount();I=[];for(let i=0;i<l;i++){const o=V.getPage(i),{width:d,height:s}=o.getSize();I.push({index:i,width:d,height:s,pdfPageData:void 0})}T=0,Me(),he(),Pe.classList.add("hidden"),Ae.classList.remove("hidden"),setTimeout(()=>Be({icons:ke}),100)}catch(n){console.error("Error loading PDF:",n),Z("Error","Error loading PDF file. Please try again with a valid PDF.","error")}}Ue.addEventListener("click",()=>{T>0&&be(T-1)});Ge.addEventListener("click",()=>{T<I.length-1&&be(T+1)});ct.addEventListener("click",()=>{Xe(),be(I.length-1)});pt.addEventListener("click",()=>{$.length>0||I.length>0?confirm("Are you sure you want to reset? All your work will be lost.")&&Ce():Ce()});const G=document.getElementById("errorModal"),qe=document.getElementById("errorModalTitle"),He=document.getElementById("errorModalMessage"),me=document.getElementById("errorModalClose");let K=null;function Z(e,n,l="error",i,o="Close"){!G||!qe||!He||!me||(qe.textContent=e,He.textContent=n,me.textContent=o,K=i||null,G.classList.remove("hidden"))}me&&me.addEventListener("click",()=>{G?.classList.add("hidden"),K&&(K(),K=null)});G&&G.addEventListener("click",e=>{e.target===G&&(G.classList.add("hidden"),K&&(K(),K=null))});tt();
