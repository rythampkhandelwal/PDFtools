import{n as m,m as S,r as A,d as b,f as k,c as C,i as M}from"./main-Dzxg2eZZ.js";import"./mobileMenu-CQFcDk7p.js";import"./full-width-CrKHpSp0.js";import"./simple-mode-footer-rW7ABm1-.js";const u={file:null};function E(){u.file=null;const n=document.getElementById("file-display-area");n&&(n.innerHTML="");const e=document.getElementById("tool-options");e&&e.classList.add("hidden");const c=document.getElementById("file-input");c&&(c.value="");const a=document.getElementById("current-password");a&&(a.value="");const t=document.getElementById("new-user-password");t&&(t.value="");const s=document.getElementById("new-owner-password");s&&(s.value="")}async function O(){const n=document.getElementById("file-display-area"),e=document.getElementById("tool-options");if(n)if(n.innerHTML="",u.file){const c=document.createElement("div");c.className="flex items-center justify-between bg-gray-700 p-3 rounded-lg text-sm";const a=document.createElement("div");a.className="flex flex-col overflow-hidden";const t=document.createElement("div");t.className="truncate font-medium text-gray-200 text-sm mb-1",t.textContent=u.file.name;const s=document.createElement("div");s.className="text-xs text-gray-400",s.textContent=k(u.file.size),a.append(t,s);const o=document.createElement("button");o.className="ml-4 text-red-400 hover:text-red-300 flex-shrink-0",o.innerHTML='<i data-lucide="trash-2" class="w-4 h-4"></i>',o.onclick=function(){E()},c.append(a,o),n.appendChild(c),C({icons:M}),e&&e.classList.remove("hidden")}else e&&e.classList.add("hidden")}function h(n){if(n&&n.length>0){const e=n[0];(e.type==="application/pdf"||e.name.toLowerCase().endsWith(".pdf"))&&(u.file=e,O())}}async function R(){if(!u.file){m("No File","Please upload a PDF file first.");return}const n=document.getElementById("current-password")?.value||"",e=document.getElementById("new-user-password")?.value||"",c=document.getElementById("new-owner-password")?.value||"",a="/input.pdf",t="/output.pdf";let s;const o=document.getElementById("loader-modal"),r=document.getElementById("loader-text");try{o&&o.classList.remove("hidden"),r&&(r.textContent="Initializing..."),s=await S(),r&&(r.textContent="Reading PDF...");const d=await A(u.file),I=new Uint8Array(d);s.FS.writeFile(a,I),r&&(r.textContent="Processing PDF permissions...");const i=[a];n&&i.push("--password="+n);const w=e||c;if(w){const f=e,l=c;i.push("--encrypt",f,l,"256");const P=document.getElementById("allow-printing")?.checked,B=document.getElementById("allow-copying")?.checked,y=document.getElementById("allow-modifying")?.checked,F=document.getElementById("allow-annotating")?.checked,x=document.getElementById("allow-filling-forms")?.checked,D=document.getElementById("allow-document-assembly")?.checked,L=document.getElementById("allow-page-extraction")?.checked;l?(y||i.push("--modify=none"),B||i.push("--extract=n"),P||i.push("--print=none"),F||i.push("--annotate=n"),D||i.push("--assemble=n"),x||i.push("--form=n"),L||i.push("--extract=n"),y||i.push("--modify-other=n")):f&&i.push("--allow-insecure")}else i.push("--decrypt");i.push("--",t);try{s.callMain(i)}catch(f){console.error("qpdf execution error:",f);const l=f.message||"";throw l.includes("invalid password")||l.includes("incorrect password")||l.includes("password")?new Error("INVALID_PASSWORD"):l.includes("encrypted")||l.includes("password required")?new Error("PASSWORD_REQUIRED"):new Error("Processing failed: "+l||"Unknown error")}r&&(r.textContent="Preparing download...");const p=s.FS.readFile(t,{encoding:"binary"});if(!p||p.length===0)throw new Error("Processing resulted in an empty file.");const v=new Blob([p],{type:"application/pdf"});b(v,`permissions-changed-${u.file.name}`),o&&o.classList.add("hidden");let g="PDF permissions changed successfully!";w||(g="PDF decrypted successfully! All encryption and restrictions removed."),m("Success",g,"success",()=>{E()})}catch(d){console.error("Error during PDF permission change:",d),o&&o.classList.add("hidden"),d.message==="INVALID_PASSWORD"?m("Incorrect Password","The current password you entered is incorrect. Please try again."):d.message==="PASSWORD_REQUIRED"?m("Password Required","This PDF is password-protected. Please enter the current password to proceed."):m("Processing Failed",`An error occurred: ${d.message||"The PDF might be corrupted or password protected."}`)}finally{try{if(s?.FS){try{s.FS.unlink(a)}catch{}try{s.FS.unlink(t)}catch{}}}catch(d){console.warn("Failed to cleanup WASM FS:",d)}}}document.addEventListener("DOMContentLoaded",function(){const n=document.getElementById("file-input"),e=document.getElementById("drop-zone"),c=document.getElementById("process-btn"),a=document.getElementById("back-to-tools");a&&a.addEventListener("click",function(){window.location.href="/"}),n&&e&&(n.addEventListener("change",function(t){h(t.target.files)}),e.addEventListener("dragover",function(t){t.preventDefault(),e.classList.add("bg-gray-700")}),e.addEventListener("dragleave",function(t){t.preventDefault(),e.classList.remove("bg-gray-700")}),e.addEventListener("drop",function(t){t.preventDefault(),e.classList.remove("bg-gray-700");const s=t.dataTransfer?.files;if(s&&s.length>0){const o=Array.from(s).filter(function(r){return r.type==="application/pdf"||r.name.toLowerCase().endsWith(".pdf")});if(o.length>0){const r=new DataTransfer;r.items.add(o[0]),h(r.files)}}}),n.addEventListener("click",function(){n.value=""})),c&&c.addEventListener("click",R)});
