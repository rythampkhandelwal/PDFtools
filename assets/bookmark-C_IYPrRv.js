import{G as _e,t as Ve,g as et,c as de,i as ue,S as tt}from"./main-Dzxg2eZZ.js";import"./mobileMenu-CQFcDk7p.js";import"./full-width-CrKHpSp0.js";import"./simple-mode-footer-rW7ABm1-.js";import{P as nt,a as I,b as ot,c as ae}from"./PDFButton-_8Cap8jz.js";import{i as lt}from"./shortcuts-init-D4ylL1rf.js";import"./index-DMQTJy3b.js";_e.workerSrc=new URL("/assets/pdf.worker.min-qwK7q_zL.mjs",import.meta.url).toString();const q=document.getElementById("modal-container");let ce=!1,re=null,z=null,ie=null,Ce=null,H=1;function we(e,n=[],t={}){return new Promise(o=>{const a=document.createElement("div");a.className="modal-overlay",a.id="active-modal-overlay";const l=document.createElement("div");l.className="modal-content",l.id="active-modal";const m=n.map(s=>{if(s.type==="text")return`
  <div class="mb-4">
    <label class="block text-sm font-medium text-gray-700 mb-2">${s.label}</label>
      <input type="text" id="modal-${s.name}" value="${Ze(t[s.name]||"")}"
class="w-full px-3 py-2 border border-gray-300 rounded-lg"
placeholder="${s.placeholder||""}" />
  </div>
    `;if(s.type==="select")return`
  <div class="mb-4">
    <label class="block text-sm font-medium text-gray-700 mb-2">${s.label}</label>
      <select id="modal-${s.name}" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
        ${s.options.map(i=>`
                                        <option value="${i.value}" ${t[s.name]===i.value?"selected":""}>
                                            ${i.label}
                                        </option>
                                    `).join("")}
</select>
                                ${s.name==="color"?'<input type="color" id="modal-color-picker" class="hidden w-full h-10 mt-2 rounded cursor-pointer border border-gray-300" value="#000000" />':""}
</div>
  `;if(s.type==="destination"){const i=t.destX!==null&&t.destX!==void 0;return`
  <div class="mb-4">
    <label class="block text-sm font-medium text-gray-700 mb-2">${s.label}</label>
      <div class="p-3 bg-gray-50 rounded-lg border border-gray-200 space-y-2">
        <div class="flex items-center gap-2">
          <label class="flex items-center gap-1 text-xs">
            <input type="checkbox" id="modal-use-destination" class="w-4 h-4" ${i?"checked":""}>
              <span>Set custom destination </span>
                </label>
                </div>
                <div id="destination-controls" class="${i?"":"hidden"} space-y-2">
                  <div class="grid grid-cols-2 gap-2">
                    <div>
                    <label class="text-xs text-gray-600">Page</label>
                      <input type="number" id="modal-dest-page" min="1" max="${s.maxPages||1}" value="${t.destPage||s.page||1}"
class="w-full px-2 py-1 border border-gray-300 rounded text-sm" step="1" />
  </div>
  <div>
  <label class="text-xs text-gray-600">Zoom(%)</label>
    <select id="modal-dest-zoom" class="w-full px-2 py-1 border border-gray-300 rounded text-sm">
      <option value="">Inherit</option>
        <option value="0">Fit Page</option>
          <option value="50">50%</option>
            <option value="75">75%</option>
              <option value="100">100%</option>
                <option value="125">125%</option>
                  <option value="150">150%</option>
                    <option value="200">200%</option>
                      </select>
                      </div>
                      </div>
                      <div class="grid grid-cols-2 gap-2">
                        <div>
                        <label class="text-xs text-gray-600">X Position</label>
                          <input type="number" id="modal-dest-x" value="0" step="10"
class="w-full px-2 py-1 border border-gray-300 rounded text-sm" />
  </div>
  <div>
  <label class="text-xs text-gray-600">Y Position</label>
    <input type="number" id="modal-dest-y" value="0" step="10"
class="w-full px-2 py-1 border border-gray-300 rounded text-sm" />
  </div>
  </div>
  <button id="modal-pick-destination" class="w-full px-3 py-2 btn-gradient text-white rounded text-xs !flex items-center justify-center gap-1">
    <i data-lucide="crosshair" class="w-3 h-3"></i> Click on PDF to Pick Location
      </button>
      <p class="text-xs text-gray-500 italic">Click the button above, then click on the PDF where you want the bookmark to jump to</p>
        </div>
        </div>
        </div>
          `}else if(s.type==="preview")return`
        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-2">${s.label}</label>
            <div id="modal-preview" class="style-preview bg-gray-50">
              <span id="preview-text" style="font-size: 16px;">Preview Text</span>
                </div>
                </div>
                  `;return""}).join("");l.innerHTML=`
                <div class="p-6">
                  <h3 class="text-xl font-bold text-gray-800 mb-4">${e}</h3>
                    <div class="mb-6">
                      ${m}
</div>
  <div class="flex gap-2 justify-end">
    <button id="modal-cancel" class="px-4 py-2 rounded-lg bg-gray-200 hover:bg-gray-300">Cancel</button>
      <button id="modal-confirm" class="px-4 py-2 rounded btn-gradient text-white">Confirm</button>
        </div>
        </div>
          `,a.appendChild(l),q.appendChild(a);function u(){const s=l.querySelector("#preview-text");if(s){const i=l.querySelector("#modal-title"),r=l.querySelector("#modal-color"),L=l.querySelector("#modal-style"),S=l.querySelector("#modal-color-picker"),T=i?i.value:"Preview Text",U=r?r.value:"",Y=L?L.value:"";s.textContent=T||"Preview Text";const Qe={red:"#dc2626",blue:"#2563eb",green:"#16a34a",yellow:"#ca8a04",purple:"#9333ea"};U==="custom"&&S?s.style.color=S.value:s.style.color=Qe[U]||"#000",s.style.fontWeight=Y==="bold"||Y==="bold-italic"?"bold":"normal",s.style.fontStyle=Y==="italic"||Y==="bold-italic"?"italic":"normal"}}const c=l.querySelector("#modal-title"),d=l.querySelector("#modal-color"),E=l.querySelector("#modal-style");c&&c.addEventListener("input",u),d&&d.addEventListener("change",s=>{const i=l.querySelector("#modal-color-picker");s.target.value==="custom"&&i?(i.classList.remove("hidden"),setTimeout(()=>i.click(),100)):i&&i.classList.add("hidden"),u()});const w=l.querySelector("#modal-color-picker");w&&w.addEventListener("input",u),E&&E.addEventListener("change",u);const f=l.querySelector("#modal-use-destination"),x=l.querySelector("#destination-controls"),p=l.querySelector("#modal-pick-destination");if(f&&x&&(f.addEventListener("change",s=>{x.classList.toggle("hidden",!s.target.checked)}),t.destX!==null&&t.destX!==void 0)){const s=l.querySelector("#modal-dest-page"),i=l.querySelector("#modal-dest-x"),r=l.querySelector("#modal-dest-y"),L=l.querySelector("#modal-dest-zoom");s&&t.destPage!==void 0&&(s.value=t.destPage),i&&t.destX!==null&&(i.value=Math.round(t.destX)),r&&t.destY!==null&&(r.value=Math.round(t.destY)),L&&t.zoom!==null&&(L.value=t.zoom||"")}p&&p.addEventListener("click",()=>{ie=a,a.style.display="none",at((s,i,r)=>{const L=l.querySelector("#modal-dest-page"),S=l.querySelector("#modal-dest-x"),T=l.querySelector("#modal-dest-y");L&&(L.value=s),S&&(S.value=Math.round(i)),T&&(T.value=Math.round(r)),a.style.display="",setTimeout(()=>{h()},100)})});const v=l.querySelector("#modal-dest-page");v&&(v.addEventListener("input",s=>{const i=parseInt(s.target.value),r=parseInt(s.target.max)||1;isNaN(i)||i<1?s.target.value=1:i>r?s.target.value=r:s.target.value=Math.floor(i),h()}),v.addEventListener("blur",s=>{const i=parseInt(s.target.value),r=parseInt(s.target.max)||1;isNaN(i)||i<1?s.target.value=1:i>r?s.target.value=r:s.target.value=Math.floor(i),h()}));function h(){if(!C)return;const s=l.querySelector("#modal-dest-page"),i=l.querySelector("#modal-dest-x"),r=l.querySelector("#modal-dest-y"),L=l.querySelector("#modal-dest-zoom"),S=s?parseInt(s.value):P,T=i?parseFloat(i.value):null,U=r?parseFloat(r.value):null,Y=L?L.value:null;S>=1&&S<=C.numPages&&Fe(S,T,U,Y)}const B=l.querySelector("#modal-dest-x"),O=l.querySelector("#modal-dest-y"),A=l.querySelector("#modal-dest-zoom");B&&B.addEventListener("input",h),O&&O.addEventListener("input",h),A&&A.addEventListener("change",h),u(),l.querySelector("#modal-cancel").addEventListener("click",()=>{_(),q.removeChild(a),o(null)}),l.querySelector("#modal-confirm").addEventListener("click",()=>{const s={};n.forEach(S=>{if(S.type!=="preview"&&S.type!=="destination"){const T=l.querySelector(`#modal-${S.name}`);s[S.name]=T.value}});const i=l.querySelector("#modal-color"),r=l.querySelector("#modal-color-picker");i&&i.value==="custom"&&r&&(s.color=r.value);const L=l.querySelector("#modal-use-destination");if(L&&L.checked){const S=l.querySelector("#modal-dest-page"),T=l.querySelector("#modal-dest-x"),U=l.querySelector("#modal-dest-y"),Y=l.querySelector("#modal-dest-zoom");s.destPage=S?parseInt(S.value):null,s.destX=T?parseFloat(T.value):null,s.destY=U?parseFloat(U.value):null,s.zoom=Y&&Y.value?Y.value:null}else s.destPage=null,s.destX=null,s.destY=null,s.zoom=null;_(),q.removeChild(a),o(s)}),a.addEventListener("click",s=>{s.target===a&&(_(),q.removeChild(a),o(null))}),setTimeout(()=>{const s=l.querySelector("input, select");s&&s.focus()},0),de({icons:ue})})}function at(e){ce=!0,re=e;const n=document.getElementById("pdf-canvas-wrapper"),t=document.getElementById("picking-mode-banner");n.classList.add("picking-mode"),t.classList.remove("hidden"),window.innerWidth<1024&&document.getElementById("show-viewer-btn").click(),de({icons:ue})}function _(){ce=!1,re=null;const e=document.getElementById("pdf-canvas-wrapper"),n=document.getElementById("picking-mode-banner");e.classList.remove("picking-mode"),n.classList.add("hidden"),z&&(z.remove(),z=null);const t=document.getElementById("destination-coord-display");t&&t.remove(),ie&&(ie.style.display="",ie=null)}document.addEventListener("DOMContentLoaded",()=>{lt();const e=document.getElementById("pdf-canvas"),n=document.getElementById("pdf-canvas-wrapper"),t=document.getElementById("cancel-picking-btn");let o=null;n.addEventListener("mousemove",a=>{if(!ce)return;const l=e.getBoundingClientRect(),m=a.clientX-l.left,u=a.clientY-l.top;o||(o=document.createElement("div"),o.className="coordinate-tooltip",n.appendChild(o)),o.textContent=`X: ${Math.round(m)}, Y: ${Math.round(u)} `,o.style.left=a.clientX-l.left+15+"px",o.style.top=a.clientY-l.top+15+"px"}),n.addEventListener("mouseleave",()=>{o&&(o.remove(),o=null)}),e.addEventListener("click",async a=>{if(!ce||!re)return;const l=e.getBoundingClientRect(),m=a.clientX-l.left,u=a.clientY-l.top;let c=Ce;c||(c=(await C.getPage(P)).getViewport({scale:H}));const d=c.width/l.width,E=c.height/l.height,w=m*d,f=c.height-u*E;z&&z.remove();const x=document.getElementById("destination-coord-display");x&&x.remove(),z=document.createElement("div"),z.className="destination-marker",z.innerHTML=`
  <svg viewBox="0 0 24 24" fill="none" stroke="#3b82f6" stroke-width="2">
    <circle cx="12" cy="12" r="10" fill="#3b82f6" fill-opacity="0.2" />
      <path d="M12 2 L12 22 M2 12 L22 12" />
        <circle cx="12" cy="12" r="2" fill="#3b82f6" />
          </svg>
            `;const p=e.getBoundingClientRect(),v=n.getBoundingClientRect();z.style.position="absolute",z.style.left=m+p.left-v.left+"px",z.style.top=u+p.top-v.top+"px",n.appendChild(z);const h=document.createElement("div");h.id="destination-coord-display",h.className="absolute bg-blue-500 text-white px-2 py-1 rounded text-xs font-mono z-50 pointer-events-none",h.style.left=m+p.left-v.left+20+"px",h.style.top=u+p.top-v.top-30+"px",h.textContent=`X: ${Math.round(w)}, Y: ${Math.round(f)} `,n.appendChild(h),re(P,w,f),setTimeout(()=>{_()},500)}),t&&t.addEventListener("click",()=>{_()})});function te(e){return new Promise(n=>{const t=document.createElement("div");t.className="modal-overlay";const o=document.createElement("div");o.className="modal-content",o.innerHTML=`
  <div class="p-6">
    <h3 class="text-xl font-bold text-gray-800 mb-4">Confirm Action</h3>
      <p class="text-gray-600 mb-6">${e}</p>
        <div class="flex gap-2 justify-end">
          <button id="modal-cancel" class="px-4 py-2 rounded-lg bg-gray-200 hover:bg-gray-300">Cancel</button>
            <button id="modal-confirm" class="px-4 py-2 rounded btn-gradient text-white">Confirm</button>
              </div>
              </div>
                `,t.appendChild(o),q.appendChild(t),o.querySelector("#modal-cancel").addEventListener("click",()=>{q.removeChild(t),n(!1)}),o.querySelector("#modal-confirm").addEventListener("click",()=>{q.removeChild(t),n(!0)}),t.addEventListener("click",a=>{a.target===t&&(q.removeChild(t),n(!1))})})}function D(e,n){return new Promise(t=>{const o=document.createElement("div");o.className="modal-overlay";const a=document.createElement("div");a.className="modal-content",a.innerHTML=`
              <div class="p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4">${e}</h3>
                  <p class="text-gray-600 mb-6">${n}</p>
                    <div class="flex justify-end">
                      <button id="modal-ok" class="px-4 py-2 rounded btn-gradient text-white">OK</button>
                        </div>
                        </div>
                          `,o.appendChild(a),q.appendChild(o),a.querySelector("#modal-ok").addEventListener("click",()=>{q.removeChild(o),t(!0)}),o.addEventListener("click",l=>{l.target===o&&(q.removeChild(o),t(!0))})})}const xe=document.getElementById("file-input"),Pe=document.getElementById("csv-input"),Ne=document.getElementById("json-input"),st=document.getElementById("auto-extract-checkbox"),Me=document.getElementById("app"),De=document.getElementById("uploader"),se=document.getElementById("file-display-area"),Le=document.getElementById("back-to-tools"),Ie=document.getElementById("back-btn"),Q=document.getElementById("pdf-canvas"),y=Q.getContext("2d"),it=document.getElementById("page-indicator"),ct=document.getElementById("prev-page"),rt=document.getElementById("next-page"),me=document.getElementById("goto-page"),ze=document.getElementById("goto-btn"),dt=document.getElementById("zoom-in-btn"),ut=document.getElementById("zoom-out-btn"),mt=document.getElementById("zoom-fit-btn"),Be=document.getElementById("zoom-indicator"),$e=document.getElementById("add-top-level-btn"),ye=document.getElementById("bookmark-title"),he=document.getElementById("bookmark-tree-list"),Se=document.getElementById("no-bookmarks"),pt=document.getElementById("download-btn"),Te=document.getElementById("undo-btn"),qe=document.getElementById("redo-btn"),gt=document.getElementById("reset-btn"),ft=document.getElementById("delete-all-btn"),ht=document.getElementById("search-bookmarks"),yt=document.getElementById("import-dropdown-btn"),vt=document.getElementById("export-dropdown-btn"),ne=document.getElementById("import-dropdown"),oe=document.getElementById("export-dropdown"),bt=document.getElementById("import-csv-btn"),xt=document.getElementById("export-csv-btn"),kt=document.getElementById("import-json-btn"),Et=document.getElementById("export-json-btn"),ve=document.getElementById("csv-import-hidden"),be=document.getElementById("json-import-hidden"),wt=document.getElementById("extract-existing-btn"),Lt=document.getElementById("current-page-display"),It=document.getElementById("filename-display"),Bt=document.getElementById("batch-mode-checkbox"),ke=document.getElementById("batch-operations"),St=document.getElementById("selected-count"),Ct=document.getElementById("batch-color-select"),Pt=document.getElementById("batch-style-select"),Nt=document.getElementById("batch-delete-btn"),Mt=document.getElementById("select-all-btn"),Dt=document.getElementById("deselect-all-btn"),zt=document.getElementById("expand-all-btn"),$t=document.getElementById("collapse-all-btn"),j=document.getElementById("show-viewer-btn"),J=document.getElementById("show-bookmarks-btn"),pe=document.getElementById("viewer-section"),ge=document.getElementById("bookmarks-section");function Tt(){window.innerWidth>=1024&&(pe.classList.remove("hidden"),ge.classList.remove("hidden"),j.classList.remove("bg-indigo-600","text-white"),j.classList.add("text-gray-300"),J.classList.remove("bg-indigo-600","text-white"),J.classList.add("text-gray-300"))}window.addEventListener("resize",Tt);j.addEventListener("click",()=>{pe.classList.remove("hidden"),ge.classList.add("hidden"),j.classList.add("bg-indigo-600","text-white"),j.classList.remove("text-gray-300"),J.classList.remove("bg-indigo-600","text-white"),J.classList.add("text-gray-300")});J.addEventListener("click",()=>{pe.classList.add("hidden"),ge.classList.remove("hidden"),J.classList.add("bg-indigo-600","text-white"),J.classList.remove("text-gray-300"),j.classList.remove("bg-indigo-600","text-white"),j.classList.add("text-gray-300")});yt.addEventListener("click",e=>{e.stopPropagation(),ne.classList.toggle("hidden"),oe.classList.add("hidden")});vt.addEventListener("click",e=>{e.stopPropagation(),oe.classList.toggle("hidden"),ne.classList.add("hidden")});document.addEventListener("click",()=>{ne.classList.add("hidden"),oe.classList.add("hidden")});let N=null,C=null,P=1,le="",g=[],F=[],M=-1,W="",G=null,V=null,Z=!1,k=new Set,R=new Set;const qt={red:"bg-red-100 border-red-300",blue:"bg-blue-100 border-blue-300",green:"bg-green-100 border-green-300",yellow:"bg-yellow-100 border-yellow-300",purple:"bg-purple-100 border-purple-300"};function $(){F=F.slice(0,M+1),F.push(JSON.parse(JSON.stringify(g))),M++,Ee()}function Xe(){M>0&&(M--,g=JSON.parse(JSON.stringify(F[M])),b(),Ee())}function Oe(){M<F.length-1&&(M++,g=JSON.parse(JSON.stringify(F[M])),b(),Ee())}function Ee(){Te.disabled=M<=0,qe.disabled=M>=F.length-1}Te.addEventListener("click",Xe);qe.addEventListener("click",Oe);gt.addEventListener("click",async()=>{await te("Reset and go back to file uploader? All unsaved changes will be lost.")&&Ye()});ft.addEventListener("click",async()=>{if(g.length===0){await D("Info","No bookmarks to delete.");return}await te(`Delete all ${g.length} bookmark(s) ? `)&&(g=[],k.clear(),K(),$(),b())});function Ye(){N=null,C=null,P=1,le="",g=[],F=[],M=-1,W="",G=null,V=null,Z=!1,k.clear(),R.clear(),xe.value="",Pe.value="",Ne.value="",Me.classList.add("hidden"),De.classList.remove("hidden"),pe.classList.remove("hidden"),ge.classList.add("hidden"),j.classList.add("bg-indigo-600","text-white"),j.classList.remove("text-gray-300"),J.classList.remove("bg-indigo-600","text-white"),J.classList.add("text-gray-300")}document.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&(e.key==="z"&&!e.shiftKey?(e.preventDefault(),Xe()):(e.key==="z"&&e.shiftKey||e.key==="y")&&(e.preventDefault(),Oe()))});Bt.addEventListener("change",e=>{Z=e.target.checked,Z||(k.clear(),K()),ke.classList.toggle("hidden",!Z||k.size===0),b()});function K(){St.textContent=k.size,Z&&ke.classList.toggle("hidden",k.size===0)}Mt.addEventListener("click",()=>{const e=n=>{let t=[];return n.forEach(o=>{t.push(o.id),o.children.length>0&&(t=t.concat(e(o.children)))}),t};e(g).forEach(n=>k.add(n)),K(),b()});Dt.addEventListener("click",()=>{k.clear(),K(),b()});Ct.addEventListener("change",e=>{if(e.target.value&&k.size>0){const n=e.target.value==="null"?null:e.target.value;je(t=>t.color=n),e.target.value=""}});Pt.addEventListener("change",e=>{if(e.target.value&&k.size>0){const n=e.target.value==="null"?null:e.target.value;je(t=>t.style=n),e.target.value=""}});Nt.addEventListener("click",async()=>{if(k.size===0||!await te(`Delete ${k.size} bookmark(s) ? `))return;const n=t=>t.filter(o=>k.has(o.id)?!1:(o.children=n(o.children),!0));g=n(g),k.clear(),K(),$(),b()});function je(e){const n=t=>t.map(o=>(k.has(o.id)&&e(o),o.children=n(o.children),o));g=n(g),$(),b()}zt.addEventListener("click",()=>{R.clear(),b()});$t.addEventListener("click",()=>{const e=n=>{n.forEach(t=>{t.children.length>0&&(R.add(t.id),e(t.children))})};e(g),b()});function Xt(e){if(e===0)return"0 Bytes";const n=1024,t=["Bytes","KB","MB","GB"],o=Math.floor(Math.log(e)/Math.log(n));return Math.round(e/Math.pow(n,o)*100)/100+" "+t[o]}function Ot(e){if(!se)return;se.innerHTML="",se.classList.remove("hidden");const n=document.createElement("div");n.className="flex items-center justify-between bg-gray-700 p-3 rounded-lg text-sm";const t=document.createElement("span");t.className="truncate font-medium text-gray-200",t.textContent=e.name;const o=document.createElement("span");o.className="flex-shrink-0 ml-4 text-gray-400",o.textContent=Xt(e.size),n.append(t,o),se.appendChild(n)}xe.addEventListener("change",Yt);async function Yt(e){const n=e?e.target.files[0]:xe.files[0];if(!n)return;le=n.name.replace(".pdf",""),It.textContent=Ve(n.name),Ot(n);const t=await n.arrayBuffer();if(P=1,g=[],F=[],M=-1,k.clear(),R.clear(),N=await nt.load(t,{ignoreEncryption:!0}),C=await et({data:new Uint8Array(t)}).promise,me.max=C.numPages,Me.classList.remove("hidden"),De.classList.add("hidden"),st.checked){const a=await Ge();a.length>0&&(g=a)}G?(g=G,G=null):V&&(g=V,V=null),$(),b(),X(P),de({icons:ue})}Pe.addEventListener("change",async e=>{const n=e.target.files[0];if(!n)return;const t=await n.text();G=Ke(t),await D("CSV Loaded",`Loaded ${G.length} bookmarks from CSV. Now upload your PDF.`)});Ne.addEventListener("change",async e=>{const n=e.target.files[0];if(!n)return;const t=await n.text();try{V=JSON.parse(t),await D("JSON Loaded","Loaded bookmarks from JSON. Now upload your PDF.")}catch{await D("Error","Invalid JSON format")}});async function X(e,n=null,t=null,o=null){if(!C)return;const a=await C.getPage(e);let l=H;n!==null&&n!==""&&n!=="0"&&(l=parseFloat(n)/100);const m=window.devicePixelRatio||1;let u=a.getViewport({scale:l});if(Ce=u,Q.height=u.height*m,Q.width=u.width*m,Q.style.width=u.width+"px",Q.style.height=u.height+"px",y.scale(m,m),await a.render({canvasContext:y,viewport:u}).promise,t!==null&&o!==null){const c=t,d=u.height-o;y.save(),y.strokeStyle="#3b82f6",y.fillStyle="#3b82f6",y.lineWidth=3,y.shadowBlur=10,y.shadowColor="rgba(59, 130, 246, 0.5)",y.beginPath(),y.arc(c,d,12,0,2*Math.PI),y.fill(),y.shadowBlur=0,y.beginPath(),y.moveTo(c-15,d),y.lineTo(c+15,d),y.moveTo(c,d-15),y.lineTo(c,d+15),y.stroke(),y.beginPath(),y.arc(c,d,6,0,2*Math.PI),y.fill(),y.stroke();const E=`X: ${Math.round(t)}, Y: ${Math.round(o)} `;y.font="bold 12px monospace";const f=y.measureText(E).width,x=18;y.fillStyle="rgba(59, 130, 246, 0.95)",y.fillRect(c+18,d-25,f+10,x),y.fillStyle="white",y.fillText(E,c+23,d-10),y.restore()}it.textContent=`Page ${e} / ${C.numPages}`,me.value=e,P=e,Lt.textContent=e}async function Fe(e,n,t,o){await X(e,o,n,t)}ct.addEventListener("click",()=>{P>1&&X(P-1)});rt.addEventListener("click",()=>{P<C.numPages&&X(P+1)});ze.addEventListener("click",()=>{const e=parseInt(me.value);e>=1&&e<=C.numPages&&X(e)});me.addEventListener("keypress",e=>{e.key==="Enter"&&ze.click()});function fe(){Be&&(Be.textContent=`${Math.round(H*100)}%`)}dt.addEventListener("click",()=>{H=Math.min(H+.05,2),fe(),X(P)});ut.addEventListener("click",()=>{H=Math.max(H-.05,.25),fe(),X(P)});mt.addEventListener("click",async()=>{C&&(H=1,fe(),X(P))});fe();ht.addEventListener("input",e=>{W=e.target.value.toLowerCase(),b()});function Re(e,n){for(let t=0;t<e.length;t++){if(e[t].id===n)return e.splice(t,1),!0;if(Re(e[t].children,n))return!0}return!1}function Je(e,n=0){let t=[];for(const o of e)t.push({...o,level:n}),o.children.length>0&&(t=t.concat(Je(o.children,n+1)));return t}function Ae(e,n){return!n||e.title.toLowerCase().includes(n)?!0:e.children.some(t=>Ae(t,n))}function He(e,n=null,t=!1){new tt(e,{group:t?"top-level-only":"nested-level-"+(n?n.id:"none"),animation:150,handle:"[data-drag-handle]",ghostClass:"sortable-ghost",dragClass:"sortable-drag",forceFallback:!0,fallbackTolerance:3,onEnd:function(o){try{if(o.oldIndex===o.newIndex){b();return}const a=JSON.parse(JSON.stringify(g));if(t){const l=a.splice(o.oldIndex,1)[0];a.splice(o.newIndex,0,l),g=a}else if(n){const l=Ue(a,n.id);if(l&&l.children){const m=l.children.splice(o.oldIndex,1)[0];l.children.splice(o.newIndex,0,m),g=a}else{b();return}}$(),b()}catch(a){console.error("Error in drag and drop:",a),M>0&&(g=JSON.parse(JSON.stringify(F[M]))),b()}}})}function Ue(e,n){if(!e||!Array.isArray(e))return null;for(const t of e){if(t.id===n)return t;if(t.children&&t.children.length>0){const o=Ue(t.children,n);if(o)return o}}return null}function jt(e){return e==="bold"?"font-bold":e==="italic"?"italic":e==="bold-italic"?"font-bold italic":""}function Ft(e){return!e||e.startsWith("#")?"":{red:"text-red-600",blue:"text-blue-600",green:"text-green-600",yellow:"text-yellow-600",purple:"text-purple-600"}[e]||""}function b(){he.innerHTML="";const e=W?g.filter(n=>Ae(n,W)):g;if(e.length===0)Se.classList.remove("hidden");else{Se.classList.add("hidden");for(const n of e)he.appendChild(We(n));He(he,null,!0)}de({icons:ue}),K()}function We(e,n=0){if(!e||!e.id)return console.error("Invalid node:",e),document.createElement("li");const t=document.createElement("li");t.dataset.bookmarkId=e.id,t.className="group";const o=e.children&&Array.isArray(e.children)&&e.children.length>0,a=R.has(e.id),l=k.has(e.id),u=(!W||e.title.toLowerCase().includes(W))&&W?"bg-yellow-100":"",c=e.color&&qt[e.color]||"",d=jt(e.style),E=Ft(e.color),w=document.createElement("div");if(w.className=`flex items-center gap-2 p-2 rounded border border-gray-200 ${c} ${u} ${l?"ring-2 ring-blue-500":""} hover:bg-gray-50`,Z){const i=document.createElement("input");i.type="checkbox",i.checked=l,i.className="w-4 h-4 flex-shrink-0",i.addEventListener("click",r=>{r.stopPropagation(),k.has(e.id)?k.delete(e.id):k.add(e.id),K(),i.checked=k.has(e.id),ke.classList.toggle("hidden",!Z||k.size===0)}),w.appendChild(i)}const f=document.createElement("div");if(f.dataset.dragHandle="true",f.className="cursor-move flex-shrink-0",f.innerHTML='<i data-lucide="grip-vertical" class="w-4 h-4 text-gray-400"></i>',w.appendChild(f),o){const i=document.createElement("button");i.className="p-0 flex-shrink-0",i.innerHTML=a?'<i data-lucide="chevron-right" class="w-4 h-4"></i>':'<i data-lucide="chevron-down" class="w-4 h-4"></i>',i.addEventListener("click",r=>{r.stopPropagation(),R.has(e.id)?R.delete(e.id):R.add(e.id),b()}),w.appendChild(i)}else{const i=document.createElement("div");i.className="w-4 flex-shrink-0",w.appendChild(i)}const x=document.createElement("div");x.className="flex-1 min-w-0 cursor-pointer";const p=e.color&&e.color.startsWith("#")?`style="color: ${e.color}"`:"",h=e.destX!==null||e.destY!==null||e.zoom!==null?'<i data-lucide="crosshair" class="w-3 h-3 inline-block ml-1 text-blue-500"></i>':"";x.innerHTML=`
                <span class="text-sm block ${d} ${E}" ${p}>${Ze(e.title)}${h}</span>
                <span class="text-xs text-gray-500">Page ${e.page}</span>
            `,x.addEventListener("click",async()=>{e.destX!==null||e.destY!==null||e.zoom!==null?(await Fe(e.page,e.destX,e.destY,e.zoom),setTimeout(()=>{e.zoom!==null&&e.zoom!==""&&e.zoom!=="0"?setTimeout(()=>{X(e.page)},1e3):X(e.page)},2e3)):X(e.page),window.innerWidth<1024&&j.click()}),w.appendChild(x);const B=document.createElement("div");B.className="flex gap-1 flex-shrink-0";const O=document.createElement("button");O.className="p-1 hover:bg-gray-200 rounded",O.title="Add child",O.innerHTML='<i data-lucide="plus" class="w-4 h-4"></i>',O.addEventListener("click",async i=>{i.stopPropagation();const r=await we("Add Child Bookmark",[{type:"text",name:"title",label:"Title",placeholder:"Enter bookmark title"}]);r&&r.title&&(e.children.push({id:Date.now()+Math.random(),title:ee(r.title),page:P,children:[],color:null,style:null,destX:null,destY:null,zoom:null}),R.delete(e.id),$(),b())}),B.appendChild(O);const A=document.createElement("button");A.className="p-1 hover:bg-gray-200 rounded",A.title="Edit",A.innerHTML='<i data-lucide="edit-2" class="w-4 h-4"></i>',A.addEventListener("click",async i=>{i.stopPropagation();const r=await we("Edit Bookmark",[{type:"text",name:"title",label:"Title",placeholder:"Enter bookmark title"},{type:"select",name:"color",label:"Color",options:[{value:"",label:"None"},{value:"red",label:"Red"},{value:"blue",label:"Blue"},{value:"green",label:"Green"},{value:"yellow",label:"Yellow"},{value:"purple",label:"Purple"},{value:"custom",label:"Custom..."}]},{type:"select",name:"style",label:"Style",options:[{value:"",label:"Normal"},{value:"bold",label:"Bold"},{value:"italic",label:"Italic"},{value:"bold-italic",label:"Bold & Italic"}]},{type:"destination",label:"Destination",page:e.page,maxPages:C?C.numPages:1},{type:"preview",label:"Preview"}],{title:e.title,color:e.color||"",style:e.style||"",destPage:e.page,destX:e.destX,destY:e.destY,zoom:e.zoom});r&&(e.title=ee(r.title),e.color=r.color||null,e.style=r.style||null,r.destPage!==null&&r.destPage!==void 0&&(e.page=r.destPage,e.destX=r.destX,e.destY=r.destY,e.zoom=r.zoom),$(),b())}),B.appendChild(A);const s=document.createElement("button");if(s.className="p-1 hover:bg-gray-200 rounded text-red-600",s.title="Delete",s.innerHTML='<i data-lucide="trash-2" class="w-4 h-4"></i>',s.addEventListener("click",async i=>{i.stopPropagation(),await te(`Delete "${e.title}"?`)&&(Re(g,e.id),$(),b())}),B.appendChild(s),w.appendChild(B),t.appendChild(w),o&&!a){const i=document.createElement("ul");i.className="child-container space-y-2";const r=JSON.parse(JSON.stringify(e));for(const L of e.children)L&&L.id&&i.appendChild(We(L,n+1));t.appendChild(i),He(i,r,!1)}return t}$e.addEventListener("click",async()=>{const e=ye.value.trim();if(!e){await D("Error","Please enter a title.");return}g.push({id:Date.now(),title:e,page:P,children:[],color:null,style:null,destX:null,destY:null,zoom:null}),$(),b(),ye.value=""});ye.addEventListener("keypress",e=>{e.key==="Enter"&&$e.click()});function Ze(e){const n=document.createElement("div");return n.textContent=e,n.innerHTML}bt.addEventListener("click",()=>{ve.click(),ne.classList.add("hidden")});ve.addEventListener("change",async e=>{const n=e.target.files[0];if(!n)return;const t=await n.text(),o=Ke(t);o.length>0&&(g=o,$(),b(),await D("Success",`Imported ${o.length} bookmarks!`)),ve.value=""});xt.addEventListener("click",()=>{if(oe.classList.add("hidden"),g.length===0){D("Error","No bookmarks to export!");return}const n=`title,page,level
`+Je(g).map(l=>`"${l.title.replace(/"/g,'""')}",${l.page},${l.level}`).join(`
`),t=new Blob([n],{type:"text/csv"}),o=URL.createObjectURL(t),a=document.createElement("a");a.href=o,a.download=`${le}-bookmarks.csv`,a.click(),URL.revokeObjectURL(o)});function Ke(e){const n=e.trim().split(`
`).slice(1),t=[],o=[{children:t,level:-1}];for(const a of n){const l=a.match(/^"(.+)",(\d+),(\d+)$/)||a.match(/^([^,]+),(\d+),(\d+)$/);if(!l)continue;const[,m,u,c]=l,d={id:Date.now()+Math.random(),title:ee(m.replace(/""/g,'"')),page:parseInt(u),children:[],color:null,style:null,destX:null,destY:null,zoom:null},E=parseInt(c);for(;o[o.length-1].level>=E;)o.pop();o[o.length-1].children.push(d),o.push({...d,level:E})}return t}kt.addEventListener("click",()=>{be.click(),ne.classList.add("hidden")});be.addEventListener("change",async e=>{const n=e.target.files[0];if(!n)return;const t=await n.text();try{let o=function(l){if(l)for(const m of l)m.title&&(m.title=ee(m.title)),m.children&&o(m.children)};const a=JSON.parse(t);o(a),g=a,$(),b(),await D("Success","Bookmarks imported from JSON!")}catch{await D("Error","Invalid JSON format")}be.value=""});Et.addEventListener("click",()=>{if(oe.classList.add("hidden"),g.length===0){D("Error","No bookmarks to export!");return}const e=JSON.stringify(g,null,2),n=new Blob([e],{type:"application/json"}),t=URL.createObjectURL(n),o=document.createElement("a");o.href=t,o.download=`${le}-bookmarks.json`,o.click(),URL.revokeObjectURL(t)});wt.addEventListener("click",async()=>{if(!N)return;const e=await Ge();e.length>0?await te(`Found ${e.length} existing bookmarks. Replace current bookmarks?`)&&(g=e,$(),b()):await D("Info","No existing bookmarks found in this PDF.")});function ee(e){return typeof e=="string"?e.replace(/[\x00-\x1F\x7F-\x9F]/g,"").trim():e}async function Ge(e){try{const n=await C.getOutline();if(console.log(n),!n)return[];async function t(a){let l=0,m=null,u=null,c=null;try{let f=a.dest;if(typeof f=="string"&&(f=await C.getDestination(f)),Array.isArray(f)){const x=f[0];if(l=await C.getPageIndex(x),f.length>2){const p=f[2],v=f[3],h=f[4];typeof p=="number"&&(m=p),typeof v=="number"&&(u=v),typeof h=="number"&&(c=String(Math.round(h*100)))}}}catch(f){console.warn("Error resolving destination:",f)}let d=null;if(a.color){const[f,x,p]=a.color,v=f/255,h=x/255,B=p/255;v>.8&&h<.3&&B<.3?d="red":v<.3&&h<.3&&B>.8?d="blue":v<.3&&h>.8&&B<.3?d="green":v>.8&&h>.8&&B<.3?d="yellow":v>.5&&h<.5&&B>.5&&(d="purple")}let E=null;a.bold&&a.italic?E="bold-italic":a.bold?E="bold":a.italic&&(E="italic");const w={id:Date.now()+Math.random(),title:ee(a.title),page:l+1,children:[],color:d,style:E,destX:m,destY:u,zoom:c};if(a.items&&a.items.length>0)for(const f of a.items){const x=await t(f);w.children.push(x)}return w}const o=[];for(const a of n){const l=await t(a);o.push(l)}return o}catch(n){return console.error("Error extracting bookmarks:",n),[]}}Le&&Le.addEventListener("click",()=>{window.location.href="/"});Ie&&Ie.addEventListener("click",()=>{window.location.href="/"});pt.addEventListener("click",async()=>{const e=N.getPages(),n=N.context.obj({}),t=N.context.register(n);function o(a,l){const m=[];for(let u=0;u<a.length;u++){const c=a[u],d=N.context.obj({}),E=N.context.register(d);d.set(I.of("Title"),ot.fromText(c.title)),d.set(I.of("Parent"),l);const w=Math.max(0,Math.min(c.page-1,e.length-1)),f=e[w].ref;let x;if(c.destX!==null||c.destY!==null||c.zoom!==null){const p=c.destX!==null?ae.of(c.destX):null,v=c.destY!==null?ae.of(c.destY):null;let h=null;c.zoom!==null&&c.zoom!==""&&c.zoom!=="0"&&(h=ae.of(parseFloat(c.zoom)/100)),x=N.context.obj([f,I.of("XYZ"),p,v,h])}else x=N.context.obj([f,I.of("XYZ"),null,null,null]);if(d.set(I.of("Dest"),x),c.color){let p;if(c.color.startsWith("#")){const v=c.color.replace("#",""),h=parseInt(v.substr(0,2),16)/255,B=parseInt(v.substr(2,2),16)/255,O=parseInt(v.substr(4,2),16)/255;p=[h,B,O]}else p={red:[1,0,0],blue:[0,0,1],green:[0,1,0],yellow:[1,1,0],purple:[.5,0,.5]}[c.color];if(p){const v=N.context.obj(p);d.set(I.of("C"),v)}}if(c.style){let p=0;c.style==="italic"?p=1:c.style==="bold"?p=2:c.style==="bold-italic"&&(p=3),p>0&&d.set(I.of("F"),ae.of(p))}if(c.children.length>0){const p=o(c.children,E);p.length>0&&(d.set(I.of("First"),p[0].ref),d.set(I.of("Last"),p[p.length-1].ref),d.set(I.of("Count"),N.context.obj(p.length)))}u>0&&(d.set(I.of("Prev"),m[u-1].ref),m[u-1].dict.set(I.of("Next"),E)),m.push({ref:E,dict:d})}return m}try{const a=o(g,t);a.length>0&&(n.set(I.of("Type"),I.of("Outlines")),n.set(I.of("First"),a[0].ref),n.set(I.of("Last"),a[a.length-1].ref),n.set(I.of("Count"),N.context.obj(a.length))),N.catalog.set(I.of("Outlines"),t);const l=await N.save(),m=new Blob([l],{type:"application/pdf"}),u=URL.createObjectURL(m),c=document.createElement("a");c.href=u,c.download=`${le}-bookmarked.pdf`,c.click(),URL.revokeObjectURL(u),await D("Success","PDF saved successfully!"),setTimeout(()=>{Ye()},500)}catch(a){console.error(a),await D("Error","Error saving PDF. Check console for details.")}});
