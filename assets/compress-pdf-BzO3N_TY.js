const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jszip.min-9lSi4Bg2.js","assets/main-Dzxg2eZZ.js","assets/main-DveUFXPi.css","assets/_commonjs-dynamic-modules-TDtrdbi3.js"])))=>i.map(i=>d[i]);
import{G as O,s as f,n as $,p as R,r as T,o as j,f as z,d as U,_ as V,g as N,c as G,i as J}from"./main-Dzxg2eZZ.js";import"./mobileMenu-CQFcDk7p.js";import"./full-width-CrKHpSp0.js";import"./simple-mode-footer-rW7ABm1-.js";import{P as W,a as d,h as K,i as Q,c as I}from"./PDFButton-_8Cap8jz.js";import"./index-DMQTJy3b.js";O.workerSrc=new URL("/assets/pdf.worker.min-qwK7q_zL.mjs",import.meta.url).toString();function H(v){const e=v.split(",")[1],n=atob(e),p=n.length,y=new Uint8Array(p);for(let m=0;m<p;m++)y[m]=n.charCodeAt(m);return y}async function M(v,e){const n=await W.load(v,{ignoreEncryption:!0}),p=n.getPages();if(e.removeMetadata)try{n.setTitle(""),n.setAuthor(""),n.setSubject(""),n.setKeywords([]),n.setCreator(""),n.setProducer("")}catch(m){console.warn("Could not remove metadata:",m)}for(let m=0;m<p.length;m++){const B=p[m].node.Resources();if(!B)continue;const k=B.lookup(d.of("XObject"));if(k instanceof K)for(const[A,E]of k.entries()){const s=n.context.lookup(E);if(!(!(s instanceof Q)||s.dict.get(d.of("Subtype"))!==d.of("Image")))try{const P=s.getContents();if(P.length<e.skipSize)continue;const t=s.dict.get(d.of("Width"))instanceof I?s.dict.get(d.of("Width")).asNumber():0,i=s.dict.get(d.of("Height"))instanceof I?s.dict.get(d.of("Height")).asNumber():0,x=s.dict.get(d.of("BitsPerComponent"))instanceof I?s.dict.get(d.of("BitsPerComponent")).asNumber():8;if(t>0&&i>0){let a=t,r=i;const l=e.scaleFactor||1;if(a=Math.floor(t*l),r=Math.floor(i*l),a>e.maxWidth||r>e.maxHeight){const u=a/r;a>r?(a=Math.min(a,e.maxWidth),r=a/u):(r=Math.min(r,e.maxHeight),a=r*u)}const g=e.minDimension||50;if(a<g||r<g)continue;const o=document.createElement("canvas"),c=o.getContext("2d");o.width=Math.floor(a),o.height=Math.floor(r);const C=new Image,L=URL.createObjectURL(new Blob([new Uint8Array(P)]));await new Promise((u,F)=>{C.onload=u,C.onerror=F,C.src=L}),c.imageSmoothingEnabled=e.smoothing!==!1,c.imageSmoothingQuality=e.smoothingQuality||"medium",e.grayscale?c.filter="grayscale(100%)":e.contrast&&(c.filter=`contrast(${e.contrast}) brightness(${e.brightness||1})`),c.drawImage(C,0,0,o.width,o.height);let D=null,h=P.length;const w=o.toDataURL("image/jpeg",e.quality),S=H(w);if(S.length<h&&(D=S,h=S.length),e.tryWebP)try{const u=o.toDataURL("image/webp",e.quality),F=H(u);F.length<h&&(D=F,h=F.length)}catch{}D&&h<P.length*e.threshold&&(s.contents=D,s.dict.set(d.of("Length"),I.of(h)),s.dict.set(d.of("Width"),I.of(o.width)),s.dict.set(d.of("Height"),I.of(o.height)),s.dict.set(d.of("Filter"),d.of("DCTDecode")),s.dict.delete(d.of("DecodeParms")),s.dict.set(d.of("BitsPerComponent"),I.of(8)),e.grayscale&&s.dict.set(d.of("ColorSpace"),d.of("DeviceGray"))),URL.revokeObjectURL(L)}}catch(P){console.warn("Skipping an uncompressible image in smart mode:",P)}}}const y={useObjectStreams:e.useObjectStreams!==!1,addDefaultPage:!1,objectsPerTick:e.objectsPerTick||50};return await n.save(y)}async function _(v,e){const n=await N({data:v}).promise,p=await W.create();for(let y=1;y<=n.numPages;y++){const m=await n.getPage(y),b=m.getViewport({scale:e.scale}),B=document.createElement("canvas"),k=B.getContext("2d");B.height=b.height,B.width=b.width,await m.render({canvasContext:k,viewport:b,canvas:B}).promise;const E=await(await new Promise(t=>B.toBlob(t,"image/jpeg",e.quality))).arrayBuffer(),s=await p.embedJpg(E);p.addPage([b.width,b.height]).drawImage(s,{x:0,y:0,width:b.width,height:b.height})}return await p.save()}document.addEventListener("DOMContentLoaded",()=>{const v=document.getElementById("file-input"),e=document.getElementById("drop-zone"),n=document.getElementById("process-btn"),p=document.getElementById("file-display-area"),y=document.getElementById("compress-options"),m=document.getElementById("file-controls"),b=document.getElementById("add-more-btn"),B=document.getElementById("clear-files-btn"),k=document.getElementById("back-to-tools");k&&k.addEventListener("click",()=>{window.location.href="/"});const A=async()=>{if(!(!p||!y||!n||!m))if(f.files.length>0){p.innerHTML="";for(let t=0;t<f.files.length;t++){const i=f.files[t],x=document.createElement("div");x.className="flex items-center justify-between bg-gray-700 p-3 rounded-lg text-sm";const a=document.createElement("div");a.className="flex flex-col overflow-hidden";const r=document.createElement("div");r.className="truncate font-medium text-gray-200 text-sm mb-1",r.textContent=i.name;const l=document.createElement("div");l.className="text-xs text-gray-400",l.textContent=`${z(i.size)} • Loading pages...`,a.append(r,l);const g=document.createElement("button");g.className="ml-4 text-red-400 hover:text-red-300 flex-shrink-0",g.innerHTML='<i data-lucide="trash-2" class="w-4 h-4"></i>',g.onclick=()=>{f.files=f.files.filter((o,c)=>c!==t),A()},x.append(a,g),p.appendChild(x);try{const o=await T(i),c=await N({data:o}).promise;l.textContent=`${z(i.size)} • ${c.numPages} pages`}catch(o){console.error("Error loading PDF:",o),l.textContent=`${z(i.size)} • Could not load page count`}}G({icons:J}),m.classList.remove("hidden"),y.classList.remove("hidden"),n.disabled=!1}else p.innerHTML="",m.classList.add("hidden"),y.classList.add("hidden"),n.disabled=!0},E=()=>{f.files=[],f.pdfDoc=null;const t=document.getElementById("compression-level");t&&(t.value="balanced");const i=document.getElementById("compression-algorithm");i&&(i.value="vector"),A()},s=async()=>{const t=document.getElementById("compression-level").value,i=document.getElementById("compression-algorithm").value,x={balanced:{smart:{quality:.5,threshold:.95,maxWidth:1800,maxHeight:1800,skipSize:3e3},legacy:{scale:1.5,quality:.6}},"high-quality":{smart:{quality:.7,threshold:.98,maxWidth:2500,maxHeight:2500,skipSize:5e3},legacy:{scale:2,quality:.9}},"small-size":{smart:{quality:.3,threshold:.95,maxWidth:1200,maxHeight:1200,skipSize:2e3},legacy:{scale:1.2,quality:.4}},extreme:{smart:{quality:.1,threshold:.95,maxWidth:1e3,maxHeight:1e3,skipSize:1e3},legacy:{scale:1,quality:.2}}},a={...x[t].smart,removeMetadata:!0},r=x[t].legacy;try{if(f.files.length===0){$("No Files","Please select at least one PDF file."),R();return}if(f.files.length===1){const l=f.files[0],g=await T(l);let o,c;if(i==="vector")j("Running Vector (Smart) compression..."),o=await M(g,a),c="Vector";else if(i==="photon")j("Running Photon (Rasterize) compression..."),o=await _(g,r),c="Photon";else{j("Running Automatic (Vector first)...");const w=await M(g,a);w.length<l.size?(o=w,c="Vector (Automatic)"):($("Vector failed to reduce size. Trying Photon...","info"),j("Running Automatic (Photon fallback)..."),o=await _(g,r),c="Photon (Automatic)")}const C=z(l.size),L=z(o.length),D=l.size-o.length,h=D>0?(D/l.size*100).toFixed(1):0;U(new Blob([o],{type:"application/pdf"}),"compressed-final.pdf"),R(),D>0?$("Compression Complete",`Method: ${c}. File size reduced from ${C} to ${L} (Saved ${h}%).`,"success",()=>E()):$("Compression Finished",`Method: ${c}. Could not reduce file size. Original: ${C}, New: ${L}.`,"warning",()=>E())}else{j("Compressing multiple PDFs...");const l=(await V(async()=>{const{default:h}=await import("./jszip.min-9lSi4Bg2.js").then(w=>w.j);return{default:h}},__vite__mapDeps([0,1,2,3]))).default,g=new l;let o=0,c=0;for(let h=0;h<f.files.length;h++){const w=f.files[h];j(`Compressing ${h+1}/${f.files.length}: ${w.name}...`);const S=await T(w);o+=w.size;let u;if(i==="vector")u=await M(S,a);else if(i==="photon")u=await _(S,r);else{const q=await M(S,a);u=q.length<w.size?q:await _(S,r)}c+=u.length;const F=w.name.replace(/\.pdf$/i,"");g.file(`${F}_compressed.pdf`,u)}const C=await g.generateAsync({type:"blob"}),L=o-c,D=L>0?(L/o*100).toFixed(1):0;U(C,"compressed-pdfs.zip"),R(),L>0?$("Compression Complete",`Compressed ${f.files.length} PDF(s). Total size reduced from ${z(o)} to ${z(c)} (Saved ${D}%).`,"success",()=>E()):$("Compression Finished",`Compressed ${f.files.length} PDF(s). Total size: ${z(c)}.`,"info",()=>E())}}catch(l){R(),$("Error",`An error occurred during compression. Error: ${l.message}`)}},P=t=>{t&&t.length>0&&(f.files=[...f.files,...Array.from(t)],A())};v&&e&&(v.addEventListener("change",t=>{P(t.target.files)}),e.addEventListener("dragover",t=>{t.preventDefault(),e.classList.add("bg-gray-700")}),e.addEventListener("dragleave",t=>{t.preventDefault(),e.classList.remove("bg-gray-700")}),e.addEventListener("drop",t=>{t.preventDefault(),e.classList.remove("bg-gray-700");const i=t.dataTransfer?.files;if(i&&i.length>0){const x=Array.from(i).filter(a=>a.type==="application/pdf"||a.name.toLowerCase().endsWith(".pdf"));if(x.length>0){const a=new DataTransfer;x.forEach(r=>a.items.add(r)),P(a.files)}}}),v.addEventListener("click",()=>{v.value=""})),b&&b.addEventListener("click",()=>{v.click()}),B&&B.addEventListener("click",()=>{E()}),n&&n.addEventListener("click",s)});
